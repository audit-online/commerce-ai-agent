// Fonctions principales
function selectBusiness(business) {
    selectedBusiness = business;
    businessData.type = business;
    
    // Mettre à jour l'interface
    document.querySelectorAll('.business-card').forEach(card => card.classList.remove('selected'));
    event.target.closest('.business-card').classList.add('selected');
    
    // Afficher le formulaire d'info
    document.getElementById('business-info').style.display = 'block';
    document.getElementById('business-info').scrollIntoView({ behavior: 'smooth' });
    
    validateBusinessInfo();
}

function validateBusinessInfo() {
    const name = document.getElementById('businessName').value;
    const city = document.getElementById('businessCity').value;
    const isValid = name.length > 2 && city.length > 2;
    
    document.getElementById('continueBtn').disabled = !isValid;
}

function showPlans() {
    // Collecter les infos
    businessData.name = document.getElementById('businessName').value;
    businessData.city = document.getElementById('businessCity').value;
    
    // Passer à la phase plans
    showPhase('plan-selection');
}

function selectPlan(plan) {
    selectedPlan = plan;
    
    // Mettre à jour l'interface
    document.querySelectorAll('.plan-card').forEach(card => card.classList.remove('selected'));
    event.target.closest('.plan-card').classList.add('selected');
    
    document.getElementById('planContinueBtn').disabled = false;
}

function showOptionSelection() {
    // Mettre à jour l'affichage
    document.getElementById('businessTypeDisplay').textContent = 
        selectedBusiness.charAt(0).toUpperCase() + selectedBusiness.slice(1);
    
    document.getElementById('selectedPlanDisplay').textContent = pricingPlans[selectedPlan].name;
    
    const plan = pricingPlans[selectedPlan];
    document.getElementById('planDescription').textContent = 
        plan.includedCount === 999 ? 'Toutes options incluses' : 
        `${plan.includedCount} options incluses + ${plan.additionalCount} options au choix`;
    
    // Passer à la phase options
    showPhase('options-selection');
    
    // Générer les options
    generateOptionsGrids();
    updatePlanSummary();
}

function generateOptionsGrids() {
    const allOptions = businessOptions[selectedBusiness] || [];
    const plan = pricingPlans[selectedPlan];
    
    // Options incluses (les plus prioritaires)
    const includedOptions = allOptions
        .sort((a, b) => a.priority - b.priority)
        .slice(0, plan.includedCount === 999 ? allOptions.length : plan.includedCount);
    
    businessData.includedOptions = includedOptions.map(opt => opt.id);
    
    // Générer grille options incluses
    const includedGrid = document.getElementById('includedOptionsGrid');
    includedGrid.innerHTML = includedOptions.map(option => `
        <div class="option-item bg-green-50 border-2 border-green-200 rounded-lg p-4">
            <div class="flex items-start justify-between mb-2">
                <h4 class="font-semibold text-sm text-green-800">${option.name}</h4>
                <div class="text-sm font-bold text-green-600">INCLUS</div>
            </div>
            <p class="text-xs text-green-700">${option.desc}</p>
            <div class="mt-2 flex items-center justify-between">
                <span class="text-xs bg-green-200 text-green-800 px-2 py-1 rounded">Inclus dans ${pricingPlans[selectedPlan].name}</span>
                <i class="fas fa-check text-green-600"></i>
            </div>
        </div>
    `).join('');
    
    // Options supplémentaires (si pas PRO)
    if (selectedPlan !== 'pro') {
        const additionalOptions = allOptions.filter(opt => !includedOptions.includes(opt));
        
        document.getElementById('additionalOptionsSection').style.display = 'block';
        document.getElementById('additionalOptionsCounter').textContent = 
            `(0/${plan.additionalCount} sélectionnées)`;
        
        const additionalGrid = document.getElementById('additionalOptionsGrid');
        additionalGrid.innerHTML = additionalOptions.map(option => `
            <div class="option-item border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-blue-300 transition-all" onclick="toggleAdditionalOption('${option.id}')">
                <div class="flex items-start justify-between mb-2">
                    <h4 class="font-semibold text-sm">${option.name}</h4>
                    <div class="text-sm font-bold text-gray-400">OPTION</div>
                </div>
                <p class="text-xs text-gray-600">${option.desc}</p>
                <div class="mt-2 flex items-center justify-between">
                    <span class="text-xs bg-gray-100 px-2 py-1 rounded">Option supplémentaire</span>
                    <i class="fas fa-plus text-gray-400"></i>
                </div>
            </div>
        `).join('');
    } else {
        document.getElementById('additionalOptionsSection').style.display = 'none';
    }
}

function toggleAdditionalOption(optionId) {
    const plan = pricingPlans[selectedPlan];
    const element = event.target.closest('.option-item');
    const index = businessData.additionalOptions.indexOf(optionId);
    
    if (index === -1 && businessData.additionalOptions.length < plan.additionalCount) {
        // Ajouter l'option
        businessData.additionalOptions.push(optionId);
        element.classList.add('selected', 'border-blue-500', 'bg-blue-50');
        element.querySelector('.fa-plus').className = 'fas fa-check text-blue-600';
        element.querySelector('.text-gray-400').textContent = 'CHOISI';
        element.querySelector('.text-gray-400').className = 'text-sm font-bold text-blue-600';
    } else if (index !== -1) {
        // Retirer l'option
        businessData.additionalOptions.splice(index, 1);
        element.classList.remove('selected', 'border-blue-500', 'bg-blue-50');
        element.querySelector('.fa-check').className = 'fas fa-plus text-gray-400';
        element.querySelector('.text-blue-600').textContent = 'OPTION';
        element.querySelector('.text-blue-600').className = 'text-sm font-bold text-gray-400';
    }
    
    // Mettre à jour le compteur
    document.getElementById('additionalOptionsCounter').textContent = 
        `(${businessData.additionalOptions.length}/${plan.additionalCount} sélectionnées)`;
}

function updatePlanSummary() {
    const plan = pricingPlans[selectedPlan];
    
    document.getElementById('currentPlanName').textContent = `💰 Plan ${plan.name}`;
    document.getElementById('planPrice').textContent = `${plan.price}€`;
    
    const featuresList = document.getElementById('planFeaturesList');
    featuresList.innerHTML = plan.features.map(feature => `
        <div class="flex items-center">
            <i class="fas fa-check text-green-500 mr-2"></i>
            <span>${feature}</span>
        </div>
    `).join('');
}

function selectStyle(style, primary, secondary) {
    businessData.style = style;
    businessData.primaryColor = primary;
    businessData.secondaryColor = secondary;
    
    // Mettre à jour les color pickers
    document.getElementById('primaryColor').value = primary;
    document.getElementById('secondaryColor').value = secondary;
                <!-- Plan Selection -->
            <div class="bg-white rounded-2xl p-8 shadow-lg mb-8">
                <h2 class="text-3xl font-bold text-center mb-8">Choisissez votre plan</h2>
                
                <div class="grid md:grid-cols-3 gap-6">
                    <button onclick="selectPlan('basic')" class="plan-card p-6 border-2 border-gray-200 rounded-xl text-center hover:border-blue-300 hover:shadow-lg transition-all">
                        <div class="text-4xl mb-4">🥉</div>
                        <div class="font-bold text-xl mb-2">BASIC</div>
                        <div class="text-3xl font-bold text-blue-600 mb-4">39€/mois</div>
                        <div class="text-sm text-gray-600 mb-4">5 options incluses<br>+ 3 options au choix</div>
                        <div class="text-xs bg-blue-100 text-blue-800 px-3 py-1 rounded-full">Pour débuter</div>
                    </button>
                    
                    <button onclick="selectPlan('premium')" class="plan-card p-6 border-2 border-orange-400 rounded-xl text-center hover:border-orange-500 hover:shadow-lg transition-all shadow-md">
                        <div class="text-4xl mb-4">🥈</div>
                        <div class="font-bold text-xl mb-2">PREMIUM</div>
                        <div class="text-3xl font-bold text-orange-600 mb-4">79€/mois</div>
                        <div class="text-sm text-gray-600 mb-4">10 options incluses<br>+ 5 options au choix</div>
                        <div class="text-xs bg-orange-100 text-orange-800 px-3 py-1 rounded-full">RECOMMANDÉ</div>
                    </button>
                    
                    <button onclick="selectPlan('pro')" class="plan-card p-6 border-2 border-gray-200 rounded-xl text-center hover:border-purple-300 hover:shadow-lg transition-all">
                        <div class="text-4xl mb-4">🥇</div>
                        <div class="font-bold text-xl mb-2">PRO</div>
                        <div class="text-3xl font-bold text-purple-600 mb-4">129€/mois</div>
                        <div class="text-sm text-gray-600 mb-4">TOUTES options incluses<br>Fonctionnalités illimitées</div>
                        <div class="text-xs bg-purple-100 text-purple-800 px-3 py-1 rounded-full">Tout inclus</div>
                    </button>
                </div>
                
                <div class="text-center mt-8">
                    <button onclick="showOptionSelection()" id="planContinueBtn" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-4 rounded-xl font-semibold text-lg hover:shadow-lg transition-all disabled:opacity-50" disabled>
                        Configurer mes Options →
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- PHASE 2: OPTIONS MÉTIER -->
<div id="options-selection" class="phase">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-4">
                <span id="businessTypeDisplay"></span> - Plan <span id="selectedPlanDisplay">BASIC</span>
            </h1>
            <p class="text-lg text-gray-600" id="planDescription">5 options incluses + 3 options au choix</p>
        </div>

        <div class="grid lg:grid-cols-4 gap-8">
            
            <!-- Options Grid -->
            <div class="lg:col-span-3">
                
                <!-- Options Incluses -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold mb-4 flex items-center">
                        <span class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">✓</span>
                        Options Incluses
                    </h2>
                    <div id="includedOptionsGrid" class="grid md:grid-cols-2 xl:grid-cols-3 gap-4">
                        <!-- Options incluses générées dynamiquement -->
                    </div>
                </div>
                
                <!-- Options Supplémentaires (si plan pas PRO) -->
                <div id="additionalOptionsSection" class="mb-8">
                    <h2 class="text-2xl font-bold mb-4 flex items-center">
                        <span class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3">+</span>
                        Options Supplémentaires
                        <span class="text-sm text-gray-500 ml-2" id="additionalOptionsCounter">(0/3 sélectionnées)</span>
                    </h2>
                    <div id="additionalOptionsGrid" class="grid md:grid-cols-2 xl:grid-cols-3 gap-4">
                        <!-- Options supplémentaires générées dynamiquement -->
                    </div>
                </div>
                
                <!-- Style & Colors -->
                <div class="bg-white rounded-2xl p-6 shadow-lg">
                    <h3 class="text-xl font-bold mb-4">🎨 Style & Personnalisation</h3>
                    
                    <!-- Style Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Style visuel</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="style-card text-center" onclick="selectStyle('moderne', '#3B82F6', '#1E40AF')">
                                <div class="w-full h-16 bg-gradient-to-r from-blue-500 to-blue-700 rounded-lg mb-3"></div>
                                <div class="font-semibold text-sm">Moderne</div>
                                <div class="text-xs text-gray-500">Bleu tech</div>
                            </div>
                            <div class="style-card text-center" onclick="selectStyle('chaleureux', '#DC2626', '#B91C1C')">
                                <div class="w-full h-16 bg-gradient-to-r from-red-600 to-red-700 rounded-lg mb-3"></div>
                                <div class="font-semibold text-sm">Chaleureux</div>
                                <div class="text-xs text-gray-500">Rouge passion</div>
                            </div>
                            <div class="style-card text-center" onclick="selectStyle('naturel', '#059669', '#047857')">
                                <div class="w-full h-16 bg-gradient-to-r from-emerald-600 to-emerald-700 rounded-lg mb-3"></div>
                                <div class="font-semibold text-sm">Naturel</div>
                                <div class="text-xs text-gray-500">Vert nature</div>
                            </div>
                            <div class="style-card text-center" onclick="selectStyle('elegant', '#7C3AED', '#6D28D9')">
                                <div class="w-full h-16 bg-gradient-to-r from-violet-600 to-violet-700 rounded-lg mb-3"></div>
                                <div class="font-semibold text-sm">Élégant</div>
                                <div class="text-xs text-gray-500">Violet premium</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Custom Colors -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Ou personnalisez vos couleurs</label>
                        <div class="flex items-center space-x-4">
                            <div>
                                <label class="block text-xs text-gray-500 mb-1">Couleur principale</label>
                                <input type="color" id="primaryColor" value="#3B82F6" onchange="updateColors()" 
                                       class="w-12 h-12 rounded-lg border-2 border-gray-300 cursor-pointer">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1">Couleur secondaire</label>
                                <input type="color" id="secondaryColor" value="#1E40AF" onchange="updateColors()" 
                                       class="w-12 h-12 rounded-lg border-2 border-gray-300 cursor-pointer">
                            </div>
                            <button onclick="resetColors()" class="text-sm text-gray-500 hover:text-gray-700">
                                <i class="fas fa-undo mr-1"></i>Reset
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Plan Summary -->
            <div class="lg:col-span-1">
                <div class="price-display">
                    <h3 class="text-xl font-bold mb-4" id="currentPlanName">💰 Plan BASIC</h3>
                    
                    <div class="mb-4">
                        <div class="text-3xl font-black mb-2" id="planPrice">39€</div>
                        <div class="text-sm text-gray-600">par mois</div>
                    </div>
                    
                    <div class="mb-4 text-sm space-y-2" id="planFeaturesList">
                        <!-- Fonctionnalités du plan -->
                    </div>
                    
                    <button onclick="generateTemplates()" id="generateBtn" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3 px-4 rounded-lg font-semibold hover:shadow-lg transition-all pulse-animation">
                        <i class="fas fa-magic mr-2"></i>
                        Générer mes Templates
                    </button>
                    
                    <div class="mt-3 text-xs text-gray-600 text-center">
                        ✨ Templates Manager + Client inclus
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- PHASE 3: TEMPLATES GÉNÉRÉS -->
<div id="templates-generated" class="phase">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent mb-4">
                🎨 Vos Templates Premium Générés
            </h1>
            <p class="text-xl text-gray-600">Templates Manager + Client pour <span id="finalBusinessName" class="font-bold text-purple-600"></span></p>
            <div class="mt-4 space-x-4">
                <button onclick="previewTemplate('manager')" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-all">
                    <i class="fas fa-expand mr-2"></i>Preview Manager
                </button>
                <button onclick="previewTemplate('client')" class="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-all">
                    <i class="fas fa-expand mr-2"></i>Preview Client
                </button>
            </div>
        </div>

        <!-- Templates Grid -->
        <div class="grid lg:grid-cols-2 gap-8 mb-8">
            
            <!-- Template Manager -->
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden hover:shadow-2xl transition-all">
                <div class="bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 text-white p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4 backdrop-blur-sm">
                            <i class="fas fa-chart-line text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold">Template Manager</h3>
                            <p class="opacity-90">Interface de gestion haut de gamme</p>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="managerPreview" class="template-preview mb-4 cursor-pointer" onclick="previewTemplate('manager')">
                        <!-- Template manager généré ici -->
                        <div class="generating h-64 flex items-center justify-center rounded-lg bg-gradient-to-br from-blue-50 to-purple-50">
                            <div class="text-center">
                                <div class="relative">
                                    <div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-opacity-25 mx-auto mb-4"></div>
                                    <div class="absolute inset-0 animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent mx-auto mb-4"></div>
                                </div>
                                <p class="text-gray-600 font-medium">Génération template manager premium...</p>
                                <p class="text-sm text-gray-500 mt-1">Interface niveau agence web</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="font-bold mb-2 flex items-center">
                            <i class="fas fa-cogs mr-2 text-blue-600"></i>
                            Fonctionnalités Manager :
                        </h4>
                        <div id="managerFeatures" class="text-sm text-gray-600">
                            <!-- Fonctionnalités listées dynamiquement -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Template Client -->
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden hover:shadow-2xl transition-all">
                <div class="bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 text-white p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4 backdrop-blur-sm">
                            <i class="fas fa-users text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold">Template Client</h3>
                            <p class="opacity-90">Experience client premium</p>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="clientPreview" class="template-preview mb-4 cursor-pointer" onclick="previewTemplate('client')">
                        <!-- Template client généré ici -->
                        <div class="generating h-64 flex items-center justify-center rounded-lg bg-gradient-to-br from-green-50 to-emerald-50">
                            <div class="text-center">
                                <div class="relative">
                                    <div class="animate-spin rounded-full h-12 w-12 border-4 border-green-600 border-opacity-25 mx-auto mb-4"></div>
                                    <div class="absolute inset-0 animate-spin rounded-full h-12 w-12 border-4 border-green-600 border-t-transparent mx-auto mb-4"></div>
                                </div>
                                <p class="text-gray-600 font-medium">Génération template client premium...</p>
                                <p class="text-sm text-gray-500 mt-1">Interface utilisateur optimisée</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="font-bold mb-2 flex items-center">
                            <i class="fas fa-heart mr-2 text-green-600"></i>
                            Fonctionnalités Client :
                        </h4>
                        <div id="clientFeatures" class="text-sm text-gray-600">
                            <!-- Fonctionnalités listées dynamiquement -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Final Summary -->
        <div class="bg-gradient-to-r from-yellow-50 via-orange-50 to-red-50 rounded-2xl p-8 border-2 border-orange-200 shadow-xl">
            <div class="text-center">
                <h2 class="text-3xl font-bold mb-4 bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent">
                    🎉 Votre Solution Premium Complète
                </h2>
                <div class="text-5xl font-black mb-4 bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent" id="finalPriceDisplay">39€/mois</div>
                <p class="text-lg text-gray-600 mb-8">Templates haut de gamme + toutes vos fonctionnalités métier</p>
                
                <div class="grid md:grid-cols-4 gap-6 mb-8">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-3">
                            📱
                        </div>
                        <div class="font-semibold">Template Manager</div>
                        <div class="text-sm text-gray-600">Interface de gestion pro</div>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-3">
                            👥
                        </div>
                        <div class="font-semibold">Template Client</div>
                        <div class="text-sm text-gray-600">Experience utilisateur</div>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-3">
                            🎨
                        </div>
                        <div class="font-semibold">Design Sur-Mesure</div>
                        <div class="text-sm text-gray-600">Couleurs personnalisées</div>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-orange-500 to-red-600 rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-3">
                            ⚡
                        </div>
                        <div class="font-semibold">Options Métier</div>
                        <div class="text-sm text-gray-600" id="totalOptionsCount">5 fonctionnalités</div>
                    </div>
                </div>
                
                <button onclick="validateSolution()" class="bg-gradient-to-r from-orange-600 via-red-600 to-pink-600 text-white px-12 py-4 rounded-xl font-bold text-xl hover:shadow-lg transition-all pulse-animation mb-4 transform hover:scale-105">
                    <i class="fas fa-handshake mr-3"></i>VALIDER CETTE SOLUTION PREMIUM
                </button>
                <div class="text-sm text-gray-600">
                    <i class="fas fa-shield-alt mr-1"></i>Essai gratuit 14 jours • Templates niveau agence web • Support premium inclus
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="text-center mt-8 space-x-4">
            <button onclick="showOptionSelection()" class="bg-gray-500 text-white px-6 py-3 rounded-xl font-semibold hover:bg-gray-600 transition-all">
                ← Modifier les Options
            </button>
            <button onclick="regenerateTemplates()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-700 transition-all">
                <i class="fas fa-sync-alt mr-2"></i>Régénérer
            </button>
        </div>
    </div>
</div>

<!-- MODAL PREVIEW PLEINE PAGE -->
<div id="fullPagePreview" class="fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center" style="display: none;">
    <div class="w-full h-full max-w-7xl mx-4 relative">
        <button onclick="closePreview()" class="absolute top-4 right-4 bg-white text-black w-12 h-12 rounded-full flex items-center justify-center hover:bg-gray-100 transition-all z-10">
            <i class="fas fa-times text-xl"></i>
        </button>
        <div id="previewContent" class="w-full h-full bg-white rounded-lg overflow-hidden shadow-2xl">
            <!-- Contenu du preview pleine page -->
        </div>
    </div>
</div>                        <div class="text-sm text-gray-600">Couleurs personnalisées</div>
                    </div>
                </div>
                
                <button onclick="validateSolution()" class="bg-gradient-to-r from-orange-600 to-red-600 text-white px-12 py-4 rounded-xl font-bold text-xl hover:shadow-lg transition-all pulse-animation mb-4">
                    <i class="fas fa-handshake mr-3"></i>VALIDER CETTE SOLUTION
                </button>
                <div class="text-sm text-gray-600">
                    <i class="fas fa-shield-alt mr-1"></i>Essai gratuit 14 jours • Résiliation à tout moment
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="text-center mt-8 space-x-4">
            <button onclick="showOptions()" class="bg-gray-500 text-white px-6 py-3 rounded-xl font-semibold hover:bg-gray-600 transition-all">
                ← Modifier les Options
            </button>
            <button onclick="regenerateTemplates()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-700 transition-all">
                <i class="fas fa-sync-alt mr-2"></i>Régénérer
            </button>
        </div>
    </div>
</div>

<script>
// Variables globales
let selectedBusiness = '';
let selectedPlan = 'basic'; // Plan par défaut
let businessData = {
    type: '',
    name: '',
    city: '',
    includedOptions: [], // Options incluses dans le plan
    additionalOptions: [], // Options supplémentaires payantes
    style: 'moderne',
    primaryColor: '#3B82F6',
    secondaryColor: '#1E40AF'
};

// Plans tarifaires avec options incluses
const pricingPlans = {
    basic: {
        price: 39,
        name: 'BASIC',
        description: 'Essentiel pour démarrer',
        includedCount: 5,
        additionalCount: 3,
        features: ['Template Manager', 'Template Client', 'Support email', 'Hébergement inclus']
    },
    premium: {
        price: 79,
        name: 'PREMIUM',
        description: 'Solution complète',
        includedCount: 10,
        additionalCount: 5,
        features: ['Tout BASIC +', 'Analytics avancées', 'Support prioritaire', 'Formations incluses', 'API access']
    },
    pro: {
        price: 129,
        name: 'PRO',
        description: 'Toutes options incluses',
        includedCount: 999, // Illimité
        additionalCount: 0,
        features: ['Tout PREMIUM +', 'Options illimitées', 'Support dédié', 'Personnalisation avancée', 'Multi-sites']
    }
};

// Options par métier (prix pour les options supplémentaires uniquement)
const businessOptions = {
    restaurant: [
        { id: 'menu_digital', name: 'Menu Digital Interactif', priority: 1, desc: 'Menu avec photos HD, allergènes, prix temps réel' },
        { id: 'reservation', name: 'Système de Réservation', priority: 1, desc: 'Planning temps réel avec confirmations automatiques' },
        { id: 'commande_ligne', name: 'Commande en Ligne', priority: 1, desc: 'Click & collect, livraison intégrée' },
        { id: 'caisse', name: 'Caisse Intégrée', priority: 1, desc: 'Encaissement et tickets de caisse' },
        { id: 'avis_clients', name: 'Gestion Avis Clients', priority: 1, desc: 'Collecte et affichage avis Google/Facebook' },
        // Options supplémentaires
        { id: 'stock_ingredients', name: 'Gestion Stock Ingrédients', priority: 2, desc: 'Suivi automatique des stocks alimentaires' },
        { id: 'planning_equipe', name: 'Planning Équipe', priority: 2, desc: 'Gestion des horaires et paies staff' },
        { id: 'fidelite', name: 'Programme Fidélité', priority: 2, desc: 'Points, récompenses et cartes clients' },
        { id: 'carte_vins', name: 'Carte des Vins', priority: 2, desc: 'Gestion cave et accords mets-vins' },
        { id: 'menu_enfants', name: 'Menu Enfants', priority: 3, desc: 'Section dédiée avec jeux et activités' },
        { id: 'allergenes', name: 'Gestion Allergènes', priority: 3, desc: 'Traçabilité complète et alertes automatiques' },
        { id: 'promotions', name: 'Système Promotions', priority: 2, desc: 'Offres spéciales et réductions ciblées' },
        { id: 'analytics', name: 'Statistiques Avancées', priority: 2, desc: 'Rapports ventes, fréquentation, rentabilité' },
        { id: 'multi_langues', name: 'Multi-langues', priority: 3, desc: 'Interface en 5 langues (EN, ES, IT, DE, FR)' },
        { id: 'wifi_clients', name: 'WiFi Clients', priority: 3, desc: 'Accès WiFi avec page de connexion branded' },
        { id: 'evenements', name: 'Gestion Événements', priority: 2, desc: 'Privatisation, séminaires, anniversaires' },
        { id: 'livraison', name: 'Livraison à Domicile', priority: 2, desc: 'Intégration Uber Eats, Deliveroo, Just Eat' },
        { id: 'click_collect', name: 'Click & Collect', priority: 2, desc: 'Commande web et retrait sur place' }
    ],
    pizzeria: [
        { id: 'menu_pizzas', name: 'Menu Pizzas Interactif', priority: 1, desc: 'Personnalisation taille, ingrédients, prix' },
        { id: 'commande_ligne', name: 'Commande en Ligne', priority: 1, desc: 'Interface de commande intuitive et rapide' },
        { id: 'livraison', name: 'Gestion Livraison', priority: 1, desc: 'Zones, délais, tracking en temps réel' },
        { id: 'click_collect', name: 'Click & Collect', priority: 1, desc: 'Commande et retrait, temps d\'attente' },
        { id: 'paiement_ligne', name: 'Paiement en Ligne', priority: 1, desc: 'CB, PayPal, Chèques déjeuner, Apple Pay' },
        // Options supplémentaires
        { id: 'personnalisation', name: 'Créateur de Pizza', priority: 2, desc: 'Interface visuelle pour composer sa pizza' },
        { id: 'promotion_combo', name: 'Promotions & Combos', priority: 2, desc: 'Offres groupées et menus famille' },
        { id: 'temps_attente', name: 'Temps d\'Attente Temps Réel', priority: 2, desc: 'Estimation dynamique de préparation' },
        { id: 'fidelite', name: 'Carte Fidélité', priority: 2, desc: 'Points et 10ème pizza gratuite' },
        { id: 'planning_fours', name: 'Planning des Fours', priority: 2, desc: 'Optimisation production et cadence' },
        { id: 'stock_ingredients', name: 'Stock Ingrédients', priority: 2, desc: 'Gestion pâte, fromage, garnitures' },
        { id: 'avis_clients', name: 'Avis Clients', priority: 3, desc: 'Notation et commentaires avec photos' },
        { id: 'multi_tailles', name: 'Multi-tailles', priority: 3, desc: 'Gestion prix selon taille (S/M/L/XL)' },
        { id: 'zone_livraison', name: 'Zones de Livraison', priority: 2, desc: 'Délimitation géographique et tarifs' },
        { id: 'tracking_commande', name: 'Suivi Commande', priority: 2, desc: 'Statut en temps réel pour le client' }
    ],
    coiffeur: [
        { id: 'planning_rdv', name: 'Planning Rendez-vous', priority: 1, desc: 'Réservation en ligne 24h/24 automatisée' },
        { id: 'gestion_coiffeurs', name: 'Gestion Coiffeurs', priority: 1, desc: 'Planning par coiffeur et spécialités' },
        { id: 'catalogue_coupes', name: 'Catalogue Coupes', priority: 1, desc: 'Photos avant/après, descriptions détaillées' },
        { id: 'tarifs_services', name: 'Grille Tarifaire', priority: 1, desc: 'Prix selon longueur, type de service' },
        { id: 'fiche_client', name: 'Fiche Client', priority: 1, desc: 'Historique, préférences, allergies colorations' },
        // Options supplémentaires
        { id: 'stock_produits', name: 'Stock Produits', priority: 2, desc: 'Shampoings, colorations, soins, accessoires' },
        { id: 'rappel_rdv', name: 'Rappels Automatiques', priority: 2, desc: 'SMS/Email 24h avant + confirmations' },
        { id: 'programme_fidelite', name: 'Programme Fidélité', priority: 2, desc: '10ème coupe gratuite + avantages VIP' },
        { id: 'conseils_beaute', name: 'Conseils Beauté', priority: 2, desc: 'Tips personnalisés selon type cheveux' },
        { id: 'vente_produits', name: 'Vente Produits', priority: 2, desc: 'E-commerce produits capillaires professionnels' },
        { id: 'avant_apres', name: 'Galerie Avant/Après', priority: 2, desc: 'Portfolio transformations avec autorisation' },
        { id: 'colorimetre', name: 'Nuancier Couleurs', priority: 3, desc: 'Palette interactive 200+ couleurs' },
        { id: 'temps_services', name: 'Durée Services', priority: 3, desc: 'Estimation temps par prestation' },
        { id: 'avis_clients', name: 'Avis Clients', priority: 3, desc: 'Notation 5 étoiles et témoignages' }
    ],
    garage: [
        { id: 'devis_ligne', name: 'Devis en Ligne', priority: 1, desc: 'Estimation automatique selon marque/modèle/année' },
        { id: 'planning_reparations', name: 'Planning Réparations', priority: 1, desc: 'Gestion créneaux atelier et mécaniciens' },
        { id: 'fiche_vehicule', name: 'Fiche Véhicule', priority: 1, desc: 'Historique complet entretien/réparations' },
        { id: 'factures_auto', name: 'Facturation Automatique', priority: 1, desc: 'Génération factures détaillées avec TVA' },
        { id: 'suivi_reparation', name: 'Suivi Réparation', priority: 1, desc: 'Étapes travaux en cours pour le client' },
        // Options supplémentaires
        { id: 'diagnostic_auto', name: 'Diagnostic Automatique', priority: 2, desc: 'Interface OBD, lecture codes erreur' },
        { id: 'stock_pieces', name: 'Stock Pièces Détachées', priority: 2, desc: 'Inventaire 10000+ références constructeurs' },
        { id: 'rappel_controle', name: 'Rappel Contrôle Technique', priority: 2, desc: 'Alertes échéances par SMS/Email' },
        { id: 'garanties', name: 'Gestion Garanties', priority: 2, desc: 'Suivi garanties pièces et main d\'œuvre' },
        { id: 'expertise', name: 'Expertise Assurance', priority: 2, desc: 'Rapports d\'expertise avec photos détaillées' },
        { id: 'geo_depannage', name: 'Géolocalisation Dépannage', priority: 2, desc: 'Service dépannage mobile 24h/24' },
        { id: 'carnet_entretien', name: 'Carnet d\'Entretien Digital', priority: 3, desc: 'Historique numérique personnalisé' },
        { id: 'alerte_revision', name: 'Alertes Révision', priority: 3, desc: 'Rappels automatiques selon kilométrage' }
    ],
    boutique: [
        { id: 'catalogue_produits', name: 'Catalogue Produits', priority: 1, desc: 'Photos HD 360°, descriptions détaillées' },
        { id: 'gestion_tailles', name: 'Gestion Tailles/Couleurs', priority: 1, desc: 'Variantes produits avec stock temps réel' },
        { id: 'stock_temps_reel', name: 'Stock Temps Réel', priority: 1, desc: 'Disponibilité instantanée et réservations' },
        { id: 'click_collect', name: 'Click & Collect', priority: 1, desc: 'Commande web, retrait magasin 2h' },
        { id: 'paiement_securise', name: 'Paiement Sécurisé', priority: 1, desc: 'CB, PayPal, Klarna, Apple Pay, Google Pay' },
        // Options supplémentaires
        { id: 'programme_vip', name: 'Programme VIP', priority: 2, desc: 'Clients privilégiés, ventes privées, avantages' },
        { id: 'lookbook', name: 'Lookbook Saisonnier', priority: 2, desc: 'Inspiration mode, tendances, style guides' },
        { id: 'essayage_virtuel', name: 'Essayage Virtuel', priority: 2, desc: 'Réalité augmentée pour vêtements/accessoires' },
        { id: 'personal_shopper', name: 'Personal Shopper', priority: 2, desc: 'Conseil style personnalisé par chat/vidéo' },
        { id: 'alertes_stock', name: 'Alertes Stock', priority: 2, desc: 'Notifications réapprovisionnement automatiques' },
        { id: 'promotions_auto', name: 'Promotions Automatiques', priority: 2, desc: 'Soldes, réductions ciblées par profil client' },
        { id: 'wishlist', name: 'Liste de Souhaits', priority: 3, desc: 'Produits favoris avec alertes prix/stock' },
        { id: 'recommandations', name: 'Recommandations IA', priority: 2, desc: 'Suggestions personnalisées machine learning' },
        { id: 'tailles_guide', name: 'Guide des Tailles', priority: 3, desc: 'Correspondances internationales et conseils' },
        { id: 'retours_echanges', name: 'Gestion Retours', priority: 2, desc: 'Politique retour/échange 30 jours' },
        { id: 'carte_fidelite', name: 'Carte Fidélité', priority: 2, desc: 'Points, cashback, paliers avantages' },
        { id: 'nouveautes', name: 'Alertes Nouveautés', priority: 3, desc: 'Notifications nouvelles collections par profil' }
    ],
    institut: [
        { id: 'planning_soins', name: 'Planning Soins', priority: 1, desc: 'Réservation selon type soin et esthéticienne' },
        { id: 'fiche_beaute', name: 'Fiche Beauté Client', priority: 1, desc: 'Type peau, allergies, historique complet soins' },
        { id: 'catalogue_soins', name: 'Catalogue Soins', priority: 1, desc: 'Descriptions détaillées, durées, tarifs, résultats' },
        { id: 'produits_conseilles', name: 'Produits Conseillés', priority: 1, desc: 'Recommandations personnalisées post-soin' },
        { id: 'rappel_rdv', name: 'Rappels RDV', priority: 1, desc: 'SMS/Email automatiques 24h avant' },
        // Options supplémentaires
        { id: 'diagnostic_peau', name: 'Diagnostic Peau IA', priority: 2, desc: 'Analyse personnalisée avec caméra HD' },
        { id: 'avant_apres', name: 'Galerie Avant/Après', priority: 2, desc: 'Portfolio résultats avec autorisation clients' },
        { id: 'forfaits_soins', name: 'Forfaits Soins', priority: 2, desc: 'Packages multi-séances avec économies' },
        { id: 'tendances_beaute', name: 'Tendances Beauté', priority: 2, desc: 'Actualités, conseils saison, nouveautés' },
        { id: 'programme_fidelite', name: 'Programme Fidélité', priority: 2, desc: 'Points cumulés, soins gratuits, privilèges' },
        { id: 'certification_bio', name: 'Certifications Bio', priority: 3, desc: 'Labels produits naturels et bio' },
        { id: 'equipe_esthetiques', name: 'Équipe Esthéticiennes', priority: 3, desc: 'Profils détaillés, spécialités, formations' },
        { id: 'conseils_maison', name: 'Conseils Maison', priority: 3, desc: 'Routine beauté quotidienne personnalisée' },
        { id: 'reservation_duo', name: 'Réservation Duo/Groupe', priority: 2, desc: 'Soins simultanés entre amies/couples' },
        { id: 'carte_cadeau', name: 'Carte Cadeau', priority: 2, desc: 'Bons cadeaux dématérialisés personnalisés' },
        { id: 'suivi_resultats', name: 'Suivi Résultats', priority: 2, desc: 'Photos évolution, mesures, conseils adaptation' }
    ],
    boulangerie: [
        { id: 'catalogue_pain', name: 'Catalogue Pains & Viennoiseries', priority: 1, desc: 'Photos HD, ingrédients, valeurs nutritionnelles' },
        { id: 'commande_avance', name: 'Commande à l\'Avance', priority: 1, desc: 'Réservation pains spéciaux, gâteaux personnalisés' },
        { id: 'production_jour', name: 'Production du Jour', priority: 1, desc: 'Disponibilité temps réel, quantités restantes' },
        { id: 'allergenes', name: 'Gestion Allergènes', priority: 1, desc: 'Traçabilité complète gluten, lactose, fruits à coque' },
        { id: 'horaires_cuisson', name: 'Horaires de Cuisson', priority: 1, desc: 'Pain chaud selon heures, notifications clients' },
        // Options supplémentaires
        { id: 'fidelite_baguette', name: 'Carte Baguette', priority: 2, desc: '10 baguettes achetées = 1 gratuite' },
        { id: 'commande_fetes', name: 'Commandes Fêtes', priority: 2, desc: 'Gâteaux anniversaire, pièces montées sur mesure' },
        { id: 'ingredients_bio', name: 'Traçabilité Bio', priority: 2, desc: 'Origine ingrédients biologiques et locaux' },
        { id: 'nutritionnel', name: 'Valeurs Nutritionnelles', priority: 3, desc: 'Calories, composition, index glycémique' },
        { id: 'sandwicherie', name: 'Sandwicherie', priority: 2, desc: 'Sandwichs sur mesure avec ingrédients frais' },
        { id: 'click_collect', name: 'Click & Collect', priority: 2, desc: 'Commande en ligne, retrait prioritaire' },
        { id: 'abonnement_pain', name: 'Abonnement Pain', priority: 2, desc: 'Livraison régulière domicile/bureau' }
    ],
    pharmacie: [
        { id: 'stock_medicaments', name: 'Stock Médicaments', priority: 1, desc: 'Disponibilité 15000+ références temps réel' },
        { id: 'ordonnances_ligne', name: 'Ordonnances en Ligne', priority: 1, desc: 'Photo ordonnance, préparation automatique' },
        { id: 'dossier_patient', name: 'Dossier Patient Sécurisé', priority: 1, desc: 'Historique, allergies, interactions médicamenteuses' },
        { id: 'tiers_payant', name: 'Tiers Payant', priority: 1, desc: 'Gestion automatique remboursements mutuelles' },
        { id: 'click_collect', name: 'Click & Collect', priority: 1, desc: 'Préparation commandes, retrait prioritaire' },
        // Options supplémentaires
        { id: 'rappel_medicaments', name: 'Rappel Prise Médicaments', priority: 2, desc: 'Alertes horaires personnalisées par SMS' },
        { id: 'generiques', name: 'Propositions Génériques', priority: 2, desc: 'Alternatives moins chères avec accord patient' },
        { id: 'garde_pharmacie', name: 'Pharmacies de Garde', priority: 3, desc: 'Géolocalisation urgences 24h/24' },
        { id: 'conseil_sante', name: 'Conseils Santé', priority: 2, desc: 'Fiches pathologies, automédication responsable' },
        { id: 'parapharmacie', name: 'Parapharmacie', priority: 2, desc: 'Cosmétiques, compléments, matériel médical' },
        { id: 'vaccination', name: 'Suivi Vaccination', priority: 2, desc: 'Calendrier vaccinal, rappels automatiques' }
    ],
    pressing: [
        { id: 'systeme_tickets', name: 'Système Tickets QR', priority: 1, desc: 'QR codes uniques, étiquetage automatique' },
        { id: 'tarifs_services', name: 'Grille Tarifaire', priority: 1, desc: 'Prix selon vêtement, matière, service' },
        { id: 'suivi_vetements', name: 'Suivi Vêtements', priority: 1, desc: 'Étapes nettoyage en temps réel' },
        { id: 'notification_pret', name: 'Notification Prêt', priority: 1, desc: 'SMS/Email automatique quand prêt' },
        { id: 'urgences', name: 'Service Urgences', priority: 1, desc: 'Nettoyage express 24h avec supplément' },
        // Options supplémentaires
        { id: 'collecte_domicile', name: 'Collecte à Domicile', priority: 2, desc: 'Service ramassage/livraison sur RDV' },
        { id: 'retouches', name: 'Retouches Couture', priority: 2, desc: 'Ourlets, réparations, ajustements' },
        { id: 'specialites', name: 'Spécialités Textiles', priority: 2, desc: 'Cuir, fourrure, robes de mariée' },
        { id: 'carte_fidelite', name: 'Carte Fidélité', priority: 2, desc: '10ème nettoyage gratuit + remises VIP' }
    ],
    opticien: [
        { id: 'catalogue_montures', name: 'Catalogue Montures', priority: 1, desc: 'Photos 360°, 500+ modèles, filtres avancés' },
        { id: 'ordonnance_ligne', name: 'Ordonnance en Ligne', priority: 1, desc: 'Upload prescription, vérification automatique' },
        { id: 'verres_options', name: 'Configurateur Verres', priority: 1, desc: 'Anti-reflet, progressifs, photochromiques' },
        { id: 'tiers_payant', name: 'Tiers Payant', priority: 1, desc: 'Mutuelle, sécurité sociale, remboursements' },
        { id: 'garanties', name: 'Garanties Montures', priority: 1, desc: 'Casse, rayures, adaptation gratuite' },
        // Options supplémentaires
        { id: 'essayage_virtuel', name: 'Essayage Virtuel AR', priority: 2, desc: 'Réalité augmentée pour tester montures' },
        { id: 'controle_vue', name: 'Contrôle de Vue', priority: 2, desc: 'Prise RDV ophtalmologue partenaire' },
        { id: 'lentilles', name: 'Gestion Lentilles', priority: 2, desc: 'Commande, abonnement, rappels renouvellement' },
        { id: 'solaires', name: 'Lunettes Solaires', priority: 2, desc: 'Collection été, verres correcteurs solaires' },
        { id: 'enfants', name: 'Section Enfants', priority: 3, desc: 'Montures adaptées, incassables, colorées' }
    ],
    fleuriste: [
        { id: 'catalogue_fleurs', name: 'Catalogue Fleurs', priority: 1, desc: 'Photos HD saisonnières, disponibilités temps réel' },
        { id: 'compositions', name: 'Compositions Personnalisées', priority: 1, desc: 'Créateur bouquets interactif, preview 3D' },
        { id: 'livraison_express', name: 'Livraison Express', priority: 1, desc: 'Même jour, créneaux 2h, géolocalisation' },
        { id: 'evenements', name: 'Fleurs Événements', priority: 1, desc: 'Mariages, deuil, fêtes, devis personnalisés' },
        { id: 'conseil_entretien', name: 'Conseils Entretien', priority: 1, desc: 'Guides prolonger durée de vie par type' },
        // Options supplémentaires
        { id: 'abonnement', name: 'Abonnement Fleurs', priority: 2, desc: 'Livraison hebdo/mensuelle, surprises saisonnières' },
        { id: 'plantes_vertes', name: 'Plantes Vertes', priority: 2, desc: 'Intérieur, extérieur, conseils jardinage' },
        { id: 'carte_message', name: 'Cartes & Messages', priority: 3, desc: 'Personnalisation messages, calligraphie' }
    ],
    dentiste: [
        { id: 'planning_rdv', name: 'Planning Rendez-vous', priority: 1, desc: 'Créneaux selon urgence, type soin, praticien' },
        { id: 'dossier_dentaire', name: 'Dossier Dentaire', priority: 1, desc: 'Historique complet, radios, schémas dentaires' },
        { id: 'devis_soins', name: 'Devis Soins', priority: 1, desc: 'Estimations prothèses, implants, remboursements' },
        { id: 'tiers_payant', name: 'Tiers Payant', priority: 1, desc: 'Mutuelle, CMU, remboursements automatiques' },
        { id: 'urgences', name: 'Urgences Dentaires', priority: 1, desc: 'Créneaux prioritaires, garde weekend' },
        // Options supplémentaires
        { id: 'rappel_controle', name: 'Rappel Contrôle', priority: 2, desc: 'Détartrage annuel, check-up préventif' },
        { id: 'conseils_hygiene', name: 'Conseils Hygiène', priority: 2, desc: 'Vidéos brossage, prévention personnalisée' },
        { id: 'orthodontie', name: 'Suivi Orthodontie', priority: 2, desc: 'Appareils, ajustements, photos évolution' },
        { id: 'radiologie', name: 'Radiologie Intégrée', priority: 2, desc: 'Panoramiques, scanners 3D, CBCT' },
        { id: 'pediatrie', name: 'Dentisterie Pédiatrique', priority: 2, desc: 'Soins adaptés enfants, jeux éducatifs' },
        { id: 'esthetique', name: 'Dentisterie Esthétique', priority: 2, desc: 'Blanchiment, facettes, sourire design' },
        { id: 'anesthesie', name: 'Gestion Anesthésie', priority: 3, desc: 'Protocoles, allergies, sédation consciente' }
    ]
};

// Options par métier (exhaustives)
const businessOptions = {
    restaurant: [
        { id: 'menu_digital', name: 'Menu Digital Interactif', price: 8, desc: 'Menu avec photos, prix, allergènes' },
        { id: 'reservation', name: 'Système de Réservation', price: 12, desc: 'Planning temps réel avec confirmations' },
        { id: 'commande_ligne', name: 'Commande en Ligne', price: 15, desc: 'Click & collect, livraison' },
        { id: 'caisse', name: 'Caisse Intégrée', price: 20, desc: 'Encaissement et tickets' },
        { id: 'stock_ingredients', name: 'Gestion Stock Ingrédients', price: 10, desc: 'Suivi automatique des stocks' },
        { id: 'planning_equipe', name: 'Planning Équipe', price: 8, desc: 'Gestion des horaires staff' },
        { id: 'fidelite', name: 'Programme Fidélité', price: 6, desc: 'Points et récompenses clients' },
        { id: 'avis_clients', name: 'Gestion Avis Clients', price: 5, desc: 'Collecte et affichage avis' },
        { id: 'carte_vins', name: 'Carte des Vins', price: 7, desc: 'Gestion cave et accords' },
        { id: 'menu_enfants', name: 'Menu Enfants', price: 3, desc: 'Section dédiée enfants' },
        { id: 'allergenes', name: 'Gestion Allergènes', price: 4, desc: 'Traçabilité et alertes' },
        { id: 'promotions', name: 'Système Promotions', price: 9, desc: 'Offres spéciales et réductions' },
        { id: 'analytics', name: 'Statistiques Avancées', price: 12, desc: 'Rapports ventes et fréquentation' },
        { id: 'multi_langues', name: 'Multi-langues', price: 8, desc: 'Interface en plusieurs langues' },
        { id: 'wifi_clients', name: 'WiFi Clients', price: 5, desc: 'Accès WiFi avec page de connexion' },
        { id: 'evenements', name: 'Gestion Événements', price: 10, desc: 'Privatisation et événements' },
        { id: 'livraison', name: 'Livraison à Domicile', price: 18, desc: 'Intégration livreurs' },
        { id: 'click_collect', name: 'Click & Collect', price: 8, desc: 'Commande et retrait sur place' }
    ],
    pizzeria: [
        { id: 'menu_pizzas', name: 'Menu Pizzas Interactif', price: 10, desc: 'Personnalisation taille, ingrédients' },
        { id: 'commande_ligne', name: 'Commande en Ligne', price: 15, desc: 'Interface de commande intuitive' },
        { id: 'livraison', name: 'Gestion Livraison', price: 20, desc: 'Zones, délais, tracking' },
        { id: 'click_collect', name: 'Click & Collect', price: 8, desc: 'Commande et retrait' },
        { id: 'personnalisation', name: 'Personnalisation Pizza', price: 12, desc: 'Créateur de pizza' },
        { id: 'promotion_combo', name: 'Promotions & Combos', price: 8, desc: 'Offres groupées' },
        { id: 'temps_attente', name: 'Temps d\'Attente', price: 6, desc: 'Estimation temps de préparation' },
        { id: 'fidelite', name: 'Carte Fidélité', price: 6, desc: 'Points et pizza gratuite' },
        { id: 'planning_fours', name: 'Planning des Fours', price: 15, desc: 'Optimisation production' },
        { id: 'stock_ingredients', name: 'Stock Ingrédients', price: 10, desc: 'Gestion pâte, fromage, etc.' },
        { id: 'avis_clients', name: 'Avis Clients', price: 5, desc: 'Notation et commentaires' },
        { id: 'multi_tailles', name: 'Multi-tailles', price: 4, desc: 'Gestion tailles différentes' },
        { id: 'zone_livraison', name: 'Zones de Livraison', price: 7, desc: 'Délimitation géographique' },
        { id: 'paiement_ligne', name: 'Paiement en Ligne', price: 12, desc: 'CB, PayPal, Chèques déjeuner' },
        { id: 'tracking_commande', name: 'Suivi Commande', price: 9, desc: 'Statut en temps réel' }
    ],
    coiffeur: [
        { id: 'planning_rdv', name: 'Planning Rendez-vous', price: 15, desc: 'Réservation en ligne automatisée' },
        { id: 'gestion_coiffeurs', name: 'Gestion Coiffeurs', price: 12, desc: 'Planning par coiffeur/spécialité' },
        { id: 'catalogue_coupes', name: 'Catalogue Coupes', price: 8, desc: 'Photos et descriptions coupes' },
        { id: 'tarifs_services', name: 'Grille Tarifaire', price: 5, desc: 'Prix selon longueur, service' },
        { id: 'fiche_client', name: 'Fiche Client', price: 10, desc: 'Historique, préférences, allergies' },
        { id: 'stock_produits', name: 'Stock Produits', price: 9, desc: 'Shampoing, coloration, etc.' },
        { id: 'rappel_rdv', name: 'Rappels Automatiques', price: 6, desc: 'SMS/Email de rappel' },
        { id: 'programme_fidelite', name: 'Programme Fidélité', price: 7, desc: '10ème coupe gratuite' },
        { id: 'conseils_beaute', name: 'Conseils Beauté', price: 5, desc: 'Tips selon type cheveux' },
        { id: 'vente_produits', name: 'Vente Produits', price: 12, desc: 'E-commerce produits capillaires' },
        { id: 'avant_apres', name: 'Galerie Avant/Après', price: 8, desc: 'Portfolio transformations' },
        { id: 'colorimetre', name: 'Nuancier Couleurs', price: 6, desc: 'Palette couleurs disponibles' },
        { id: 'temps_services', name: 'Durée Services', price: 4, desc: 'Estimation temps par prestation' },
        { id: 'avis_clients', name: 'Avis Clients', price: 5, desc: 'Notation et témoignages' }
    ],
    garage: [
        { id: 'devis_ligne', name: 'Devis en Ligne', price: 15, desc: 'Estimation selon marque/modèle' },
        { id: 'planning_reparations', name: 'Planning Réparations', price: 12, desc: 'Gestion créneaux atelier' },
        { id: 'diagnostic_auto', name: 'Diagnostic Automatique', price: 20, desc: 'Interface OBD, codes erreur' },
        { id: 'fiche_vehicule', name: 'Fiche Véhicule', price: 10, desc: 'Historique entretien/réparations' },
        { id: 'stock_pieces', name: 'Stock Pièces Détachées', price: 18, desc: 'Gestion inventaire pièces' },
        { id: 'suivi_reparation', name: 'Suivi Réparation', price: 8, desc: 'Étapes travaux en cours' },
        { id: 'factures_auto', name: 'Facturation Automatique', price: 12, desc: 'Génération factures détaillées' },
        { id: 'rappel_controle', name: 'Rappel Contrôle Technique', price: 6, desc: 'Alertes échéances' },
        { id: 'garanties', name: 'Gestion Garanties', price: 7, desc: 'Suivi garanties pièces/main d\'œuvre' },
        { id: 'expertise', name: 'Expertise Assurance', price: 15, desc: 'Rapports d\'expertise' },
        { id: 'geo_depannage', name: 'Géolocalisation Dépannage', price: 10, desc: 'Service dépannage mobile' },
        { id: 'carnet_entretien', name: 'Carnet d\'Entretien Digital', price: 8, desc: 'Historique numérique' },
        { id: 'alerte_revision', name: 'Alertes Révision', price: 5, desc: 'Rappels selon kilométrage' }
    ],
    boutique: [
        { id: 'catalogue_produits', name: 'Catalogue Produits', price: 12, desc: 'Photos HD, descriptions détaillées' },
        { id: 'gestion_tailles', name: 'Gestion Tailles/Couleurs', price: 8, desc: 'Variantes produits' },
        { id: 'stock_temps_reel', name: 'Stock Temps Réel', price: 15, desc: 'Disponibilité instantanée' },
        { id: 'click_collect', name: 'Click & Collect', price: 10, desc: 'Commande web, retrait magasin' },
        { id: 'programme_vip', name: 'Programme VIP', price: 12, desc: 'Clients privilégiés, avantages' },
        { id: 'lookbook', name: 'Lookbook Saisonnier', price: 9, desc: 'Inspiration mode, tendances' },
        { id: 'essayage_virtuel', name: 'Essayage Virtuel', price: 25, desc: 'AR/réalité augmentée' },
        { id: 'personal_shopper', name: 'Personal Shopper', price: 18, desc: 'Conseil style personnalisé' },
        { id: 'alertes_stock', name: 'Alertes Stock', price: 6, desc: 'Notification réapprovisionnement' },
        { id: 'promotions_auto', name: 'Promotions Automatiques', price: 10, desc: 'Soldes, réductions ciblées' },
        { id: 'wishlist', name: 'Liste de Souhaits', price: 5, desc: 'Produits favoris clients' },
        { id: 'recommandations', name: 'Recommandations IA', price: 15, desc: 'Suggestions personnalisées' },
        { id: 'tailles_guide', name: 'Guide des Tailles', price: 4, desc: 'Correspondances tailles' },
        { id: 'retours_echanges', name: 'Gestion Retours', price: 8, desc: 'Politique retour/échange' },
        { id: 'carte_fidelite', name: 'Carte Fidélité', price: 7, desc: 'Points, cashback' },
        { id: 'nouveautes', name: 'Alertes Nouveautés', price: 6, desc: 'Notification nouvelles collections' },
        { id: 'mode_paiement', name: 'Multi-Paiements', price: 12, desc: 'CB, PayPal, Klarna, etc.' }
    ],
    boulangerie: [
        { id: 'catalogue_pain', name: 'Catalogue Pains & Viennoiseries', price: 8, desc: 'Photos, ingrédients, prix' },
        { id: 'commande_avance', name: 'Commande à l\'Avance', price: 12, desc: 'Réservation pain spéciaux' },
        { id: 'production_jour', name: 'Production du Jour', price: 6, desc: 'Disponibilité en temps réel' },
        { id: 'allergenes', name: 'Gestion Allergènes', price: 5, desc: 'Traçabilité gluten, lactose, etc.' },
        { id: 'fidelite_baguette', name: 'Carte Baguette', price: 4, desc: '10 baguettes = 1 gratuite' },
        { id: 'horaires_cuisson', name: 'Horaires de Cuisson', price: 3, desc: 'Pain chaud selon heures' },
        { id: 'commande_fetes', name: 'Commandes Fêtes', price: 15, desc: 'Gâteaux personnalisés' },
        { id: 'ingredients_bio', name: 'Traçabilité Bio', price: 7, desc: 'Origine ingrédients biologiques' },
        { id: 'nutritionnel', name: 'Valeurs Nutritionnelles', price: 6, desc: 'Calories, composition' },
        { id: 'sandwicherie', name: 'Sandwicherie', price: 10, desc: 'Sandwichs sur mesure' },
        { id: 'click_collect', name: 'Click & Collect', price: 8, desc: 'Commande et retrait' },
        { id: 'abonnement_pain', name: 'Abonnement Pain', price: 12, desc: 'Livraison régulière' }
    ],
    institut: [
        { id: 'planning_soins', name: 'Planning Soins', price: 15, desc: 'Réservation selon type de soin' },
        { id: 'fiche_beaute', name: 'Fiche Beauté Client', price: 12, desc: 'Type peau, historique soins' },
        { id: 'catalogue_soins', name: 'Catalogue Soins', price: 10, desc: 'Descriptions, durées, tarifs' },
        { id: 'diagnostic_peau', name: 'Diagnostic Peau', price: 18, desc: 'Analyse personnalisée' },
        { id: 'avant_apres', name: 'Galerie Avant/Après', price: 8, desc: 'Résultats transformations' },
        { id: 'produits_conseilles', name: 'Produits Conseillés', price: 10, desc: 'Recommandations personnalisées' },
        { id: 'forfaits_soins', name: 'Forfaits Soins', price: 12, desc: 'Packages multi-séances' },
        { id: 'rappel_rdv', name: 'Rappels RDV', price: 6, desc: 'SMS/Email automatiques' },
        { id: 'tendances_beaute', name: 'Tendances Beauté', price: 7, desc: 'Actualités, conseils saison' },
        { id: 'programme_fidelite', name: 'Programme Fidélité', price: 8, desc: 'Points, soins gratuits' },
        { id: 'certification_bio', name: 'Certifications Bio', price: 5, desc: 'Labels produits naturels' },
        { id: 'equipe_esthetiques', name: 'Équipe Esthéticiennes', price: 6, desc: 'Profils, spécialités' },
        { id: 'conseils_maison', name: 'Conseils Maison', price: 4, desc: 'Routine beauté quotidienne' },
        { id: 'reservation_duo', name: 'Réservation Duo/Groupe', price: 9, desc: 'Soins entre amies' },
        { id: 'carte_cadeau', name: 'Carte Cadeau', price: 8, desc: 'Bons cadeaux personnalisés' },
        { id: 'suivi_resultats', name: 'Suivi Résultats', price: 10, desc: 'Photos évolution, conseils' }
    ],
    pharmacie: [
        { id: 'stock_medicaments', name: 'Stock Médicaments', price: 20, desc: 'Disponibilité temps réel' },
        { id: 'ordonnances_ligne', name: 'Ordonnances en Ligne', price: 15, desc: 'Envoi photo ordonnance' },
        { id: 'rappel_medicaments', name: 'Rappel Prise Médicaments', price: 8, desc: 'Alertes horaires' },
        { id: 'dossier_patient', name: 'Dossier Patient', price: 18, desc: 'Historique, allergies, interactions' },
        { id: 'generiques', name: 'Propositions Génériques', price: 6, desc: 'Alternatives moins chères' },
        { id: 'garde_pharmacie', name: 'Pharmacies de Garde', price: 5, desc: 'Localisation urgences' },
        { id: 'conseil_sante', name: 'Conseils Santé', price: 7, desc: 'Fiches pathologies courantes' },
        { id: 'parapharmacie', name: 'Parapharmacie', price: 12, desc: 'Cosmétiques, compléments' },
        { id: 'tiers_payant', name: 'Tiers Payant', price: 15, desc: 'Gestion remboursements' },
        { id: 'vaccination', name: 'Suivi Vaccination', price: 10, desc: 'Calendrier vaccinal' },
        { id: 'click_collect', name: 'Click & Collect', price: 8, desc: 'Préparation commandes' }
    ],
    pressing: [
        { id: 'systeme_tickets', name: 'Système Tickets', price: 10, desc: 'QR codes, étiquetage' },
        { id: 'tarifs_services', name: 'Grille Tarifaire', price: 5, desc: 'Prix selon vêtement/service' },
        { id: 'suivi_vetements', name: 'Suivi Vêtements', price: 12, desc: 'Étapes nettoyage en cours' },
        { id: 'notification_pret', name: 'Notification Prêt', price: 6, desc: 'SMS/Email quand prêt' },
        { id: 'collecte_domicile', name: 'Collecte à Domicile', price: 15, desc: 'Service de ramassage' },
        { id: 'urgences', name: 'Service Urgences', price: 8, desc: 'Nettoyage express 24h' },
        { id: 'retouches', name: 'Retouches Couture', price: 12, desc: 'Ourlets, réparations' },
        { id: 'specialites', name: 'Spécialités Textiles', price: 10, desc: 'Cuir, fourrure, mariage' },
        { id: 'carte_fidelite', name: 'Carte Fidélité', price: 6, desc: '10ème nettoyage gratuit' }
    ],
    opticien: [
        { id: 'catalogue_montures', name: 'Catalogue Montures', price: 12, desc: 'Photos 360°, essayage virtuel' },
        { id: 'ordonnance_ligne', name: 'Ordonnance en Ligne', price: 8, desc: 'Upload prescription' },
        { id: 'essayage_virtuel', name: 'Essayage Virtuel', price: 20, desc: 'AR pour tester montures' },
        { id: 'verres_options', name: 'Options Verres', price: 10, desc: 'Anti-reflet, progressifs, etc.' },
        { id: 'tiers_payant', name: 'Tiers Payant', price: 12, desc: 'Mutuelle, sécurité sociale' },
        { id: 'controle_vue', name: 'Contrôle de Vue', price: 15, desc: 'Prise RDV ophtalmologue' },
        { id: 'lentilles', name: 'Gestion Lentilles', price: 8, desc: 'Commande, abonnement' },
        { id: 'garanties', name: 'Garanties Montures', price: 6, desc: 'Casse, rayures' },
        { id: 'solaires', name: 'Lunettes Solaires', price: 9, desc: 'Collection été, prescription' },
        { id: 'enfants', name: 'Section Enfants', price: 7, desc: 'Montures adaptées, incassables' }
    ],
    fleuriste: [
        { id: 'catalogue_fleurs', name: 'Catalogue Fleurs', price: 10, desc: 'Photos saisons, disponibilités' },
        { id: 'compositions', name: 'Compositions Personnalisées', price: 15, desc: 'Créateur de bouquets' },
        { id: 'livraison_express', name: 'Livraison Express', price: 12, desc: 'Même jour, créneaux' },
        { id: 'evenements', name: 'Fleurs Événements', price: 18, desc: 'Mariages, deuil, fêtes' },
        { id: 'abonnement', name: 'Abonnement Fleurs', price: 8, desc: 'Livraison hebdo/mensuelle' },
        { id: 'conseil_entretien', name: 'Conseils Entretien', price: 4, desc: 'Prolonger durée de vie' },
        { id: 'plantes_vertes', name: 'Plantes Vertes', price: 8, desc: 'Intérieur, extérieur' },
        { id: 'carte_message', name: 'Cartes & Messages', price: 3, desc: 'Personnalisation messages' }
    ],
    dentiste: [
        { id: 'planning_rdv', name: 'Planning Rendez-vous', price: 15, desc: 'Créneaux selon urgence/soin' },
        { id: 'dossier_dentaire', name: 'Dossier Dentaire', price: 18, desc: 'Historique, radios, traitements' },
        { id: 'rappel_controle', name: 'Rappel Contrôle', price: 6, desc: 'Détartrage, check-up annuel' },
        { id: 'devis_soins', name: 'Devis Soins', price: 10, desc: 'Estimations prothèses, implants' },
        { id: 'urgences', name: 'Urgences Dentaires', price: 12, desc: 'Créneaux prioritaires' },
        { id: 'tiers_payant', name: 'Tiers Payant', price: 15, desc: 'Mutuelle, CMU' },
        { id: 'conseils_hygiene', name: 'Conseils Hygiène', price: 5, desc: 'Brossage, prévention' },
        { id: 'orthodontie', name: 'Suivi Orthodontie', price: 12, desc: 'Appareils, ajustements' },
        { id: 'radiologie', name: 'Radiologie Intégrée', price: 20, desc: 'Panoramiques, scanners' },
        { id: 'pediatrie', name: 'Dentisterie Pédiatrique', price: 8, desc: 'Soins adaptés enfants' },
        { id: 'esthetique', name: 'Dentisterie Esthétique', price: 15, desc: 'Blanchiment, facettes' },
        { id: 'anesthesie', name: 'Gestion Anesthésie', price: 7, desc: 'Protocoles, allergies' }
    ]
};

// Photos générées par IA pour chaque métier
const businessPhotos = {
    restaurant: [
        'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&h=300&fit=crop&crop=center',
        'https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=400&h=300&fit=crop&crop=center',
        'https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?w=400&h=300&fit=crop&crop=center'
    ],
    pizzeria: [
        'https://images.unsplash.com/photo-1513104890138-7c749659a591?w=400&h=300&fit=crop&crop=center',
        'https://images.unsplash.com/photo-1571407970349-bc81e7e96d47?w=400&h=300&fit=crop&crop=center'
    ],
    coiffeur: [
        'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=400&h=300&fit=crop&crop=center',
        'https://images.unsplash.com/photo-1522336572468-97b06e8ef143?w=400&h=300&fit=crop&crop=center'
    ],
    boutique: [
        'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=400&h=300&fit=crop&crop=center',
        'https://images.unsplash.com/photo-1472851294608-062f824d29cc?w=400&h=300&fit=crop&crop=center'
    ]
};

// Fonctions principales
function selectBusiness(business) {
    selectedBusiness = business;
    businessData.type = business;
    
    // Mettre à jour l'interface
    document.querySelectorAll('.business-card').forEach(card => card.classList.remove('selected'));
    event.target.closest('.business-card').classList.add('selected');
    
    // Afficher le formulaire d'info
    document.getElementById('business-info').style.display = 'block';
    document.getElementById('business-info').scrollIntoView({ behavior: 'smooth' });
    
    validateBusinessInfo();
}

function validateBusinessInfo() {
    const name = document.getElementById('businessName').value;
    const city = document.getElementById('businessCity').value;
    const isValid = name.length > 2 && city.length > 2;
    
    document.getElementById('continueBtn').disabled = !isValid;
}

function showOptions() {
    // Collecter les infos
    businessData.name = document.getElementById('businessName').value;
    businessData.city = document.getElementById('businessCity').value;
    
    // Passer à la phase options
    showPhase('options-selection');
    
    // Mettre à jour l'affichage
    document.getElementById('businessTypeDisplay').textContent = 
        selectedBusiness.charAt(0).toUpperCase() + selectedBusiness.slice(1);
    
    // Générer les options
    generateOptionsGrid();
}

function generateOptionsGrid() {
    const options = businessOptions[selectedBusiness] || [];
    const grid = document.getElementById('optionsGrid');
    
    grid.innerHTML = options.map(option => `
        <div class="option-item" onclick="toggleOption('${option.id}', ${option.price})">
            <div class="flex items-start justify-between mb-2">
                <h4 class="font-semibold text-sm">${option.name}</h4>
                <div class="text-lg font-bold text-green-600">+${option.price}€</div>
            </div>
            <p class="text-xs text-gray-600">${option.desc}</p>
            <div class="mt-2 flex items-center justify-between">
                <span class="text-xs bg-gray-100 px-2 py-1 rounded">Option métier</span>
                <i class="fas fa-plus text-gray-400"></i>
            </div>
        </div>
    `).join('');
}

function toggleOption(optionId, price) {
    const element = event.target.closest('.option-item');
    const index = businessData.selectedOptions.findIndex(opt => opt.id === optionId);
    
    if (index === -1) {
        // Ajouter l'option
        businessData.selectedOptions.push({ id: optionId, price: price });
        element.classList.add('selected');
        element.querySelector('.fa-plus').className = 'fas fa-check text-green-600';
    } else {
        // Retirer l'option
        businessData.selectedOptions.splice(index, 1);
        element.classList.remove('selected');
        element.querySelector('.fa-check').className = 'fas fa-plus text-gray-400';
    }
    
    updatePriceCalculator();
}

function updatePriceCalculator() {
    const optionsPrice = businessData.selectedOptions.reduce((sum, opt) => sum + opt.price, 0);
    const basePrice = 19; // Template design
    const totalPrice = optionsPrice + basePrice;
    
    // Mettre à jour l'affichage
    document.getElementById('selectedCount').textContent = businessData.selectedOptions.length;
    document.getElementById('optionsPrice').textContent = optionsPrice + '€';
    document.getElementById('totalPrice').textContent = totalPrice + '€';
    document.getElementById('calculatedPrice').textContent = totalPrice + '€';
    
    // Déterminer le plan
    let plan = { name: 'BASIC', features: 'Template + options de base' };
    if (totalPrice >= 60 && totalPrice < 100) {
        plan = { name: 'PREMIUM', features: 'Solution avancée' };
    } else if (totalPrice >= 100) {
        plan = { name: 'PRO', features: 'Solution complète' };
    }
    
    document.getElementById('planName').textContent = plan.name;
    document.getElementById('planFeatures').textContent = plan.features;
    
    // Activer le bouton si au moins 1 option
    document.getElementById('generateBtn').disabled = businessData.selectedOptions.length === 0;
}

function selectStyle(style, primary, secondary) {
    businessData.style = style;
    businessData.primaryColor = primary;
    businessData.secondaryColor = secondary;
    
    // Mettre à jour les color pickers
    document.getElementById('primaryColor').value = primary;
    document.getElementById('secondaryColor').value = secondary;
    
    // Mettre à jour l'interface
    document.querySelectorAll('.style-card').forEach(card => card.classList.remove('selected'));
    event.target.closest('.style-card').classList.add('selected');
}

function updateColors() {
    businessData.primaryColor = document.getElementById('primaryColor').value;
    businessData.secondaryColor = document.getElementById('secondaryColor').value;
    
    // Désélectionner les styles prédéfinis
    document.querySelectorAll('.style-card').forEach(card => card.classList.remove('selected'));
}

function resetColors() {
    businessData.primaryColor = '#3B82F6';
    businessData.secondaryColor = '#1E40AF';
    document.getElementById('primaryColor').value = '#3B82F6';
    document.getElementById('secondaryColor').value = '#1E40AF';
}

function generateTemplates() {
    // Passer à la phase de génération
    showPhase('templates-generated');
    
    // Mettre à jour les infos finales
    document.getElementById('finalBusinessName').textContent = businessData.name;
    document.getElementById('finalPriceDisplay').textContent = document.getElementById('calculatedPrice').textContent;
    
    // Générer les templates avec délai pour l'effet
    setTimeout(() => {
        generateManagerTemplate();
    }, 1000);
    
    setTimeout(() => {
        generateClientTemplate();
    }, 2000);
    
    setTimeout(() => {
        updateFeaturesLists();
    }, 3000);
}

function generateManagerTemplate() {
    const photos = businessPhotos[selectedBusiness] || businessPhotos.restaurant;
    
    const managerHTML = `
        <div class="bg-white rounded-lg overflow-hidden shadow-lg">
            <!-- Header Manager -->
            <div class="p-4" style="background: linear-gradient(135deg, ${businessData.primaryColor}, ${businessData.secondaryColor});">
                <div class="flex items-center text-white">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div>
                        <h3 class="font-bold">${businessData.name} - Manager</h3>
                        <p class="text-sm opacity-90">Interface de gestion</p>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard -->
            <div class="p-4">
                <div class="grid grid-cols-3 gap-3 mb-4">
                    <div class="bg-green-50 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600">247</div>
                        <div class="text-xs text-gray-600">Clients</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-600">1,2k€</div>
                        <div class="text-xs text-gray-600">CA Jour</div>
                    </div>
                    <div class="bg-purple-50 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-purple-600">89%</div>
                        <div class="text-xs text-gray-600">Satisfaction</div>
                    </div>
                </div>
                
                <!-- Navigation -->
                <div class="space-y-2">
                    ${getManagerNavigation()}
                </div>
                
                <!-- Quick Actions -->
                <div class="mt-4 grid grid-cols-2 gap-2">
                    <button class="p-2 rounded-lg text-white text-sm font-semibold" style="background: ${businessData.primaryColor};">
                        <i class="fas fa-plus mr-1"></i>Nouveau
                    </button>
                    <button class="p-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-semibold">
                        <i class="fas fa-chart-bar mr-1"></i>Stats
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('managerPreview').innerHTML = managerHTML;
}

function generateClientTemplate() {
    const photos = businessPhotos[selectedBusiness] || businessPhotos.restaurant;
    
    const clientHTML = `
        <div class="bg-white rounded-lg overflow-hidden shadow-lg">
            <!-- Hero Section -->
            <div class="relative h-32 overflow-hidden">
                <img src="${photos[0]}" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-40"></div>
                <div class="absolute inset-0 flex items-center justify-center text-white text-center">
                    <div>
                        <h2 class="text-lg font-bold">${businessData.name}</h2>
                        <p class="text-sm opacity-90">${businessData.city}</p>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="p-4">
                <!-- Quick Actions -->
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <button class="p-3 rounded-lg text-white font-semibold text-sm" style="background: ${businessData.primaryColor};">
                        <i class="fas fa-${getClientMainIcon()} mr-2"></i>
                        ${getClientMainAction()}
                    </button>
                    <button class="p-3 border-2 rounded-lg font-semibold text-sm" style="border-color: ${businessData.secondaryColor}; color: ${businessData.secondaryColor};">
                        <i class="fas fa-info-circle mr-2"></i>
                        Infos
                    </button>
                </div>
                
                <!-- Features Grid -->
                <div class="space-y-2">
                    ${getClientFeaturesList()}
                </div>
                
                <!-- Contact -->
                <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center text-sm text-gray-600">
                        <i class="fas fa-map-marker-alt mr-2"></i>
                        <span>${businessData.city}</span>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('clientPreview').innerHTML = clientHTML;
}

function getManagerNavigation() {
    const navItems = {
        restaurant: ['Dashboard', 'Réservations', 'Menu', 'Commandes', 'Stock', 'Équipe', 'Analytics'],
        pizzeria: ['Dashboard', 'Commandes', 'Menu Pizzas', 'Livraisons', 'Stock', 'Analytics'],
        coiffeur: ['Dashboard', 'Rendez-vous', 'Clients', 'Services', 'Équipe', 'Stock', 'Analytics'],
        garage: ['Dashboard', 'Réparations', 'Devis', 'Véhicules', 'Stock Pièces', 'Planning'],
        boutique: ['Dashboard', 'Produits', 'Commandes', 'Stock', 'Clients', 'Promotions'],
        institut: ['Dashboard', 'Rendez-vous', 'Clients', 'Soins', 'Produits', 'Analytics']
    };
    
    const items = navItems[selectedBusiness] || navItems.restaurant;
    
    return items.slice(0, 6).map(item => `
        <div class="flex items-center p-2 hover:bg-gray-50 rounded text-sm">
            <i class="fas fa-chevron-right mr-3 text-gray-400"></i>
            <span>${item}</span>
        </div>
    `).join('');
}

function getClientMainIcon() {
    const icons = {
        restaurant: 'utensils',
        pizzeria: 'pizza-slice',
        coiffeur: 'cut',
        garage: 'car',
        boutique: 'shopping-bag',
        institut: 'spa',
        boulangerie: 'bread-slice',
        pharmacie: 'pills',
        pressing: 'tshirt',
        opticien: 'glasses',
        fleuriste: 'seedling',
        dentiste: 'tooth'
    };
    return icons[selectedBusiness] || 'store';
}

function getClientMainAction() {
    const actions = {
        restaurant: 'Réserver',
        pizzeria: 'Commander',
        coiffeur: 'RDV',
        garage: 'Devis',
        boutique: 'Acheter',
        institut: 'RDV Soin',
        boulangerie: 'Commander',
        pharmacie: 'Ordonnance',
        pressing: 'Déposer',
        opticien: 'Essayer',
        fleuriste: 'Composer',
        dentiste: 'RDV'
    };
    return actions[selectedBusiness] || 'Découvrir';
}

function getClientFeaturesList() {
    // Prendre les 4 premières options sélectionnées
    const selectedFeatures = businessData.selectedOptions.slice(0, 4);
    const allOptions = businessOptions[selectedBusiness] || [];
    
    return selectedFeatures.map(selected => {
        const option = allOptions.find(opt => opt.id === selected.id);
        if (!option) return '';
        
        return `
            <div class="flex items-center p-2 text-sm">
                <i class="fas fa-check-circle mr-3 text-green-500"></i>
                <span>${option.name}</span>
            </div>
        `;
    }).join('');
}

function updateFeaturesLists() {
    // Features Manager
    const managerFeatures = businessData.selectedOptions.map(opt => {
        const option = businessOptions[selectedBusiness].find(o => o.id === opt.id);
        return option ? option.name : '';
    }).filter(name => name).join(' • ');
    
    document.getElementById('managerFeatures').textContent = managerFeatures || 'Gestion de base incluse';
    
    // Features Client
    const clientFeatures = businessData.selectedOptions.slice(0, 5).map(opt => {
        const option = businessOptions[selectedBusiness].find(o => o.id === opt.id);
        return option ? option.name : '';
    }).filter(name => name).join(' • ');
    
    document.getElementById('clientFeatures').textContent = clientFeatures || 'Interface client de base';
}

function regenerateTemplates() {
    // Remettre les loading
    document.getElementById('managerPreview').innerHTML = `
        <div class="generating h-64 flex items-center justify-center">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                <p class="text-gray-600">Régénération...</p>
            </div>
        </div>
    `;
    
    document.getElementById('clientPreview').innerHTML = `
        <div class="generating h-64 flex items-center justify-center">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"></div>
                <p class="text-gray-600">Régénération...</p>
            </div>
        </div>
    `;
    
    // Régénérer après délai
    setTimeout(() => {
        generateManagerTemplate();
        generateClientTemplate();
    }, 2000);
}

function validateSolution() {
    // Envoyer au CRM parent
    if (window.parent !== window) {
        window.parent.postMessage({
            type: 'BUSINESS_SOLUTION_VALIDATED',
            data: {
                business: selectedBusiness,
                businessData: businessData,
                totalPrice: document.getElementById('calculatedPrice').textContent,
                selectedOptions: businessData.selectedOptions,
                timestamp: new Date().toISOString()
            }
        }, '*');
    }
    
    // Animation de succès
    const successDiv = document.createElement('div');
    successDiv.innerHTML = `
        <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
            <div class="bg-white rounded-2xl p-8 text-center max-w-md mx-4">
                <div class="text-6xl mb-4">🎉</div>
                <h2 class="text-2xl font-bold mb-4 text-green-600">Solution Validée !</h2>
                <p class="text-gray-600 mb-6">Votre prospect est conquis par ces templates métier personnalisés !</p>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span>Métier:</span>
                        <span class="font-semibold capitalize">${selectedBusiness}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Options:</span>
                        <span class="font-semibold">${businessData.selectedOptions.length}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Prix:</span>
                        <span class="font-semibold text-green-600">${document.getElementById('calculatedPrice').textContent}</span>
                    </div>
                </div>
                <button onclick="this.parentElement.parentElement.remove()" class="mt-6 bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-all">
                    Parfait ! 🚀
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(successDiv);
}

// Navigation entre phases
function showPhase(phaseId) {
    document.querySelectorAll('.phase').forEach(phase => phase.classList.remove('active'));
    setTimeout(() => {
        document.getElementById(phaseId).classList.add('active');
    }, 100);
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Validation temps réel des infos business
    ['businessName', 'businessCity'].forEach(id => {
        document.getElementById(id).addEventListener('input', validateBusinessInfo);
    });
    
    console.log('🎯 Agent IA Métier initialisé !');
});

// Health check
window.healthCheck = function() {
    return {
        status: 'healthy',
        version: '4.0-business-focused',
        timestamp: new Date().toISOString(),
        selectedBusiness: selectedBusiness,
        optionsCount: businessData.selectedOptions.length
    };
};
</script>

</body>
</html><!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎯 Agent IA Métier - Templates Sur-Mesure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Animations */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        
        .fade-in { animation: fadeInUp 0.5s ease-out; }
        .pulse-animation { animation: pulse 2s infinite; }
        
        /* Phase management */
        .phase { display: none; opacity: 0; transition: all 0.3s ease; }
        .phase.active { display: block; opacity: 1; }
        
        /* Cards */
        .business-card {
            background: white; border-radius: 16px; padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); transition: all 0.3s ease;
            border: 2px solid transparent; cursor: pointer;
        }
        .business-card:hover { transform: translateY(-3px); box-shadow: 0 8px 30px rgba(0,0,0,0.12); }
        .business-card.selected { 
            border-color: #3B82F6; background: linear-gradient(135deg, #EFF6FF, #DBEAFE); 
            transform: translateY(-3px) scale(1.02);
        }
        
        /* Options grid */
        .option-item {
            background: white; border: 2px solid #E5E7EB; border-radius: 12px;
            padding: 1rem; cursor: pointer; transition: all 0.2s ease;
        }
        .option-item:hover { border-color: #3B82F6; background: #F8FAFC; }
        .option-item.selected { 
            border-color: #10B981; background: linear-gradient(135deg, #ECFDF5, #D1FAE5);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
        }
        
        /* Style selector */
        .style-card {
            background: white; border-radius: 12px; padding: 1.5rem;
            border: 2px solid #E5E7EB; cursor: pointer; transition: all 0.3s ease;
        }
        .style-card:hover { border-color: #8B5CF6; transform: translateY(-2px); }
        .style-card.selected { 
            border-color: #8B5CF6; background: linear-gradient(135deg, #F3E8FF, #E9D5FF);
        }
        
        /* Color picker */
        .color-option {
            width: 50px; height: 50px; border-radius: 12px; cursor: pointer;
            border: 3px solid #E5E7EB; transition: all 0.2s ease;
        }
        .color-option:hover { transform: scale(1.1); }
        .color-option.selected { border-color: #1F2937; box-shadow: 0 0 0 2px white, 0 0 0 4px #1F2937; }
        
        /* Price calculator */
        .price-display {
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            border: 2px solid #F59E0B; border-radius: 16px; padding: 2rem;
            text-align: center; position: sticky; top: 20px;
        }
        
        /* Templates preview */
        .template-preview {
            border-radius: 12px; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        /* Loading states */
        .generating {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%; animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-blue-50 min-h-screen">

<!-- PHASE 1: SÉLECTION MÉTIER -->
<div id="business-selection" class="phase active">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        
        <!-- Header -->
        <div class="text-center mb-12 fade-in">
            <h1 class="text-5xl font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4">
                🎯 Agent IA Métier
            </h1>
            <p class="text-xl text-gray-600 mb-6">Templates intelligents selon VOTRE métier</p>
            <div class="inline-flex items-center px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-semibold">
                ✨ Fonctionnalités métier analysées par IA
            </div>
        </div>

        <!-- Business Selection -->
        <div class="mb-12">
            <h2 class="text-3xl font-bold text-center mb-8">Quel est votre métier ?</h2>
            <div class="grid md:grid-cols-3 lg:grid-cols-4 gap-6">
                
                <!-- Restaurant -->
                <div class="business-card" onclick="selectBusiness('restaurant')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🍽️</div>
                        <h3 class="font-bold text-lg mb-2">Restaurant</h3>
                        <p class="text-sm text-gray-600">Cuisine, bar, café</p>
                        <div class="mt-3 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                            18 options métier
                        </div>
                    </div>
                </div>
                
                <!-- Pizzeria -->
                <div class="business-card" onclick="selectBusiness('pizzeria')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🍕</div>
                        <h3 class="font-bold text-lg mb-2">Pizzeria</h3>
                        <p class="text-sm text-gray-600">Pizza, livraison</p>
                        <div class="mt-3 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                            15 options métier
                        </div>
                    </div>
                </div>
                
                <!-- Boulangerie -->
                <div class="business-card" onclick="selectBusiness('boulangerie')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🥖</div>
                        <h3 class="font-bold text-lg mb-2">Boulangerie</h3>
                        <p class="text-sm text-gray-600">Pain, pâtisserie</p>
                        <div class="mt-3 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                            12 options métier
                        </div>
                    </div>
                </div>
                
                <!-- Coiffeur -->
                <div class="business-card" onclick="selectBusiness('coiffeur')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">✂️</div>
                        <h3 class="font-bold text-lg mb-2">Coiffeur</h3>
                        <p class="text-sm text-gray-600">Coupe, couleur</p>
                        <div class="mt-3 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                            14 options métier
                        </div>
                    </div>
                </div>
                
                <!-- Institut Beauté -->
                <div class="business-card" onclick="selectBusiness('institut')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">💅</div>
                        <h3 class="font-bold text-lg mb-2">Institut Beauté</h3>
                        <p class="text-sm text-gray-600">Soins, esthétique</p>
                        <div class="mt-3 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                            16 options métier
                        </div>
                    </div>
                </div>
                
                <!-- Garage -->
                <div class="business-card" onclick="selectBusiness('garage')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🔧</div>
                        <h3 class="font-bold text-lg mb-2">Garage</h3>
                        <p class="text-sm text-gray-600">Réparation auto</p>
                        <div class="mt-3 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                            13 options métier
                        </div>
                    </div>
                </div>
                
                <!-- Boutique -->
                <div class="business-card" onclick="selectBusiness('boutique')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">👗</div>
                        <h3 class="font-bold text-lg mb-2">Boutique</h3>
                        <p class="text-sm text-gray-600">Vêtements, mode</p>
                        <div class="mt-3 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                            17 options métier
                        </div>
                    </div>
                </div>
                
                <!-- Pharmacie -->
                <div class="business-card" onclick="selectBusiness('pharmacie')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">💊</div>
                        <h3 class="font-bold text-lg mb-2">Pharmacie</h3>
                        <p class="text-sm text-gray-600">Médicaments, santé</p>
                        <div class="mt-3 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                            11 options métier
                        </div>
                    </div>
                </div>
                
                <!-- Pressing -->
                <div class="business-card" onclick="selectBusiness('pressing')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">👔</div>
                        <h3 class="font-bold text-lg mb-2">Pressing</h3>
                        <p class="text-sm text-gray-600">Nettoyage, retouches</p>
                        <div class="mt-3 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                            9 options métier
                        </div>
                    </div>
                </div>
                
                <!-- Opticien -->
                <div class="business-card" onclick="selectBusiness('opticien')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">👓</div>
                        <h3 class="font-bold text-lg mb-2">Opticien</h3>
                        <p class="text-sm text-gray-600">Lunettes, lentilles</p>
                        <div class="mt-3 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                            10 options métier
                        </div>
                    </div>
                </div>
                
                <!-- Fleuriste -->
                <div class="business-card" onclick="selectBusiness('fleuriste')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🌸</div>
                        <h3 class="font-bold text-lg mb-2">Fleuriste</h3>
                        <p class="text-sm text-gray-600">Fleurs, compositions</p>
                        <div class="mt-3 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                            8 options métier
                        </div>
                    </div>
                </div>
                
                <!-- Dentiste -->
                <div class="business-card" onclick="selectBusiness('dentiste')">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🦷</div>
                        <h3 class="font-bold text-lg mb-2">Dentiste</h3>
                        <p class="text-sm text-gray-600">Soins dentaires</p>
                        <div class="mt-3 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                            12 options métier
                        </div>
                    </div>
                </div>
                
            </div>
        </div>

        <!-- Business Info Input -->
        <div id="business-info" class="bg-white rounded-2xl p-8 shadow-lg mb-8" style="display: none;">
            <h3 class="text-2xl font-bold mb-6">Informations de base</h3>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nom de votre établissement</label>
                    <input type="text" id="businessName" placeholder="Ex: Chez Mario, Salon Élégance..." 
                           class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 transition-all">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Ville</label>
                    <input type="text" id="businessCity" placeholder="Ex: Paris, Lyon..." 
                           class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 transition-all">
                </div>
            </div>
            
            <div class="text-center mt-8">
                <button onclick="showOptions()" id="continueBtn" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-4 rounded-xl font-semibold text-lg hover:shadow-lg transition-all disabled:opacity-50" disabled>
                    Voir les Options Métier →
                </button>
            </div>
        </div>
    </div>
</div>

<!-- PHASE 2: OPTIONS MÉTIER -->
<div id="options-selection" class="phase">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-4">
                <span id="businessTypeDisplay"></span> - Options Métier
            </h1>
            <p class="text-lg text-gray-600">Sélectionnez les fonctionnalités dont vous avez besoin</p>
        </div>

        <div class="grid lg:grid-cols-4 gap-8">
            
            <!-- Options Grid -->
            <div class="lg:col-span-3">
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold">Fonctionnalités disponibles</h2>
                        <div class="text-sm text-gray-600">
                            <span id="selectedCount">0</span> options sélectionnées
                        </div>
                    </div>
                    <div id="optionsGrid" class="grid md:grid-cols-2 xl:grid-cols-3 gap-4">
                        <!-- Options générées dynamiquement -->
                    </div>
                </div>
                
                <!-- Style & Colors -->
                <div class="bg-white rounded-2xl p-6 shadow-lg mb-6">
                    <h3 class="text-xl font-bold mb-4">Style & Personnalisation</h3>
                    
                    <!-- Style Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Style visuel</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="style-card text-center" onclick="selectStyle('moderne', '#3B82F6', '#1E40AF')">
                                <div class="w-full h-16 bg-gradient-to-r from-blue-500 to-blue-700 rounded-lg mb-3"></div>
                                <div class="font-semibold text-sm">Moderne</div>
                                <div class="text-xs text-gray-500">Bleu tech</div>
                            </div>
                            <div class="style-card text-center" onclick="selectStyle('chaleureux', '#DC2626', '#B91C1C')">
                                <div class="w-full h-16 bg-gradient-to-r from-red-600 to-red-700 rounded-lg mb-3"></div>
                                <div class="font-semibold text-sm">Chaleureux</div>
                                <div class="text-xs text-gray-500">Rouge passion</div>
                            </div>
                            <div class="style-card text-center" onclick="selectStyle('naturel', '#059669', '#047857')">
                                <div class="w-full h-16 bg-gradient-to-r from-emerald-600 to-emerald-700 rounded-lg mb-3"></div>
                                <div class="font-semibold text-sm">Naturel</div>
                                <div class="text-xs text-gray-500">Vert nature</div>
                            </div>
                            <div class="style-card text-center" onclick="selectStyle('elegant', '#7C3AED', '#6D28D9')">
                                <div class="w-full h-16 bg-gradient-to-r from-violet-600 to-violet-700 rounded-lg mb-3"></div>
                                <div class="font-semibold text-sm">Élégant</div>
                                <div class="text-xs text-gray-500">Violet premium</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Custom Colors -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Ou personnalisez vos couleurs</label>
                        <div class="flex items-center space-x-4">
                            <div>
                                <label class="block text-xs text-gray-500 mb-1">Couleur principale</label>
                                <input type="color" id="primaryColor" value="#3B82F6" onchange="updateColors()" 
                                       class="w-12 h-12 rounded-lg border-2 border-gray-300 cursor-pointer">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-500 mb-1">Couleur secondaire</label>
                                <input type="color" id="secondaryColor" value="#1E40AF" onchange="updateColors()" 
                                       class="w-12 h-12 rounded-lg border-2 border-gray-300 cursor-pointer">
                            </div>
                            <button onclick="resetColors()" class="text-sm text-gray-500 hover:text-gray-700">
                                <i class="fas fa-undo mr-1"></i>Reset
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Price Calculator -->
            <div class="lg:col-span-1">
                <div class="price-display">
                    <h3 class="text-xl font-bold mb-4">💰 Votre Devis</h3>
                    
                    <div class="mb-4">
                        <div class="text-3xl font-black mb-2" id="calculatedPrice">0€</div>
                        <div class="text-sm text-gray-600">par mois</div>
                    </div>
                    
                    <div class="mb-4 text-sm">
                        <div class="flex justify-between mb-1">
                            <span>Fonctionnalités:</span>
                            <span id="optionsPrice">0€</span>
                        </div>
                        <div class="flex justify-between mb-1">
                            <span>Template design:</span>
                            <span>19€</span>
                        </div>
                        <div class="flex justify-between font-semibold border-t pt-1">
                            <span>Total:</span>
                            <span id="totalPrice">19€</span>
                        </div>
                    </div>
                    
                    <div class="mb-4 p-3 bg-white rounded-lg text-center">
                        <div class="font-semibold text-green-600" id="planName">BASIC</div>
                        <div class="text-xs text-gray-600" id="planFeatures">Template + options de base</div>
                    </div>
                    
                    <button onclick="generateTemplates()" id="generateBtn" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3 px-4 rounded-lg font-semibold hover:shadow-lg transition-all pulse-animation disabled:opacity-50" disabled>
                        <i class="fas fa-magic mr-2"></i>
                        Générer mes Templates
                    </button>
                    
                    <div class="mt-3 text-xs text-gray-600 text-center">
                        ✨ Templates Manager + Client inclus
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- PHASE 3: TEMPLATES GÉNÉRÉS -->
<div id="templates-generated" class="phase">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent mb-4">
                🎨 Vos Templates Générés
            </h1>
            <p class="text-xl text-gray-600">Templates Manager + Client pour <span id="finalBusinessName" class="font-bold text-purple-600"></span></p>
        </div>

        <!-- Templates Grid -->
        <div class="grid lg:grid-cols-2 gap-8 mb-8">
            
            <!-- Template Manager -->
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4">
                            <i class="fas fa-chart-line text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold">Template Manager</h3>
                            <p class="opacity-90">Interface de gestion</p>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="managerPreview" class="template-preview mb-4">
                        <!-- Template manager généré ici -->
                        <div class="generating h-64 flex items-center justify-center">
                            <div class="text-center">
                                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                                <p class="text-gray-600">Génération template manager...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="font-bold mb-2 flex items-center">
                            <i class="fas fa-cogs mr-2 text-blue-600"></i>
                            Fonctionnalités Manager :
                        </h4>
                        <div id="managerFeatures" class="text-sm text-gray-600">
                            <!-- Fonctionnalités listées dynamiquement -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Template Client -->
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                <div class="bg-gradient-to-r from-green-600 to-teal-600 text-white p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4">
                            <i class="fas fa-users text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold">Template Client</h3>
                            <p class="opacity-90">Interface client</p>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="clientPreview" class="template-preview mb-4">
                        <!-- Template client généré ici -->
                        <div class="generating h-64 flex items-center justify-center">
                            <div class="text-center">
                                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"></div>
                                <p class="text-gray-600">Génération template client...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="font-bold mb-2 flex items-center">
                            <i class="fas fa-heart mr-2 text-green-600"></i>
                            Fonctionnalités Client :
                        </h4>
                        <div id="clientFeatures" class="text-sm text-gray-600">
                            <!-- Fonctionnalités listées dynamiquement -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Final Summary -->
        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-8 border-2 border-orange-200">
            <div class="text-center">
                <h2 class="text-3xl font-bold mb-4">🎉 Votre Solution Complète</h2>
                <div class="text-5xl font-black mb-4" id="finalPriceDisplay">39€/mois</div>
                <p class="text-lg text-gray-600 mb-8">2 templates professionnels + toutes vos fonctionnalités</p>
                
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="text-center">
                        <div class="text-2xl mb-2">📱</div>
                        <div class="font-semibold">Template Manager</div>
                        <div class="text-sm text-gray-600">Gestion complète</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl mb-2">👥</div>
                        <div class="font-semibold">Template Client</div>
                        <div class="text-sm text-gray-600">Experience utilisateur</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl mb-2">🎨</div>
                        <div class="font-semibold">Design Sur-Mesure</div>
                       <div class="text-sm text-gray-600">Couleurs personnalisées</div>
                    </div>
                </div>
                
                <button onclick="validateSolution()" class="bg-gradient-to-r from-orange-600 to-red-600 text-white px-12 py-4 rounded-xl font-bold text-xl hover:shadow-lg transition-all pulse-animation mb-4 transform hover:scale-105">
                    <i class="fas fa-handshake mr-3"></i>VALIDER CETTE SOLUTION PREMIUM
                </button>
                <div class="text-sm text-gray-600">
                    <i class="fas fa-shield-alt mr-1"></i>Essai gratuit 14 jours • Templates niveau agence web • Support premium inclus
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="text-center mt-8 space-x-4">
            <button onclick="showOptionSelection()" class="bg-gray-500 text-white px-6 py-3 rounded-xl font-semibold hover:bg-gray-600 transition-all">
                ← Modifier les Options
            </button>
            <button onclick="regenerateTemplates()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-700 transition-all">
                <i class="fas fa-sync-alt mr-2"></i>Régénérer
            </button>
        </div>
    </div>
</div>

<!-- MODAL PREVIEW PLEINE PAGE -->
<div id="fullPagePreview" class="fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center" style="display: none;">
    <div class="w-full h-full max-w-7xl mx-4 relative">
        <button onclick="closePreview()" class="absolute top-4 right-4 bg-white text-black w-12 h-12 rounded-full flex items-center justify-center hover:bg-gray-100 transition-all z-10">
            <i class="fas fa-times text-xl"></i>
        </button>
        <div id="previewContent" class="w-full h-full bg-white rounded-lg overflow-hidden shadow-2xl">
            <!-- Contenu du preview pleine page -->
        </div>
    </div>
</div>

<script>
// Variables globales
let selectedBusiness = '';
let selectedPlan = 'basic';
let businessData = {
    type: '',
    name: '',
    city: '',
    includedOptions: [],
    additionalOptions: [],
    style: 'moderne',
    primaryColor: '#3B82F6',
    secondaryColor: '#1E40AF'
};

// Plans tarifaires V3.0
const pricingPlans = {
    basic: {
        price: 39,
        name: 'BASIC',
        description: 'Essentiel pour démarrer',
        includedCount: 5,
        additionalCount: 3,
        features: ['Template Manager Premium', 'Template Client Premium', 'Support email', 'Hébergement inclus', '5 options métier incluses']
    },
    premium: {
        price: 79,
        name: 'PREMIUM',
        description: 'Solution complète recommandée',
        includedCount: 10,
        additionalCount: 5,
        features: ['Tout BASIC +', 'Analytics avancées', 'Support prioritaire', 'Formations incluses', 'API access', '10 options métier incluses']
    },
    pro: {
        price: 129,
        name: 'PRO',
        description: 'Toutes options incluses',
        includedCount: 999,
        additionalCount: 0,
        features: ['Tout PREMIUM +', 'TOUTES options incluses', 'Support dédié 24/7', 'Personnalisation avancée', 'Multi-sites', 'Fonctionnalités illimitées']
    }
};

// Options par métier avec priorités
const businessOptions = {
    restaurant: [
        { id: 'menu_digital', name: 'Menu Digital Interactif', priority: 1, desc: 'Menu avec photos HD, allergènes, prix temps réel' },
        { id: 'reservation', name: 'Système de Réservation', priority: 1, desc: 'Planning temps réel avec confirmations automatiques' },
        { id: 'commande_ligne', name: 'Commande en Ligne', priority: 1, desc: 'Click & collect, livraison intégrée' },
        { id: 'caisse', name: 'Caisse Intégrée', priority: 1, desc: 'Encaissement et tickets de caisse' },
        { id: 'avis_clients', name: 'Gestion Avis Clients', priority: 1, desc: 'Collecte et affichage avis Google/Facebook' },
        { id: 'stock_ingredients', name: 'Gestion Stock Ingrédients', priority: 2, desc: 'Suivi automatique des stocks alimentaires' },
        { id: 'planning_equipe', name: 'Planning Équipe', priority: 2, desc: 'Gestion des horaires et paies staff' },
        { id: 'fidelite', name: 'Programme Fidélité', priority: 2, desc: 'Points, récompenses et cartes clients' },
        { id: 'carte_vins', name: 'Carte des Vins', priority: 2, desc: 'Gestion cave et accords mets-vins' },
        { id: 'menu_enfants', name: 'Menu Enfants', priority: 3, desc: 'Section dédiée avec jeux et activités' },
        { id: 'allergenes', name: 'Gestion Allergènes', priority: 3, desc: 'Traçabilité complète et alertes automatiques' },
        { id: 'promotions', name: 'Système Promotions', priority: 2, desc: 'Offres spéciales et réductions ciblées' },
        { id: 'analytics', name: 'Statistiques Avancées', priority: 2, desc: 'Rapports ventes, fréquentation, rentabilité' },
        { id: 'multi_langues', name: 'Multi-langues', priority: 3, desc: 'Interface en 5 langues (EN, ES, IT, DE, FR)' },
        { id: 'wifi_clients', name: 'WiFi Clients', priority: 3, desc: 'Accès WiFi avec page de connexion branded' },
        { id: 'evenements', name: 'Gestion Événements', priority: 2, desc: 'Privatisation, séminaires, anniversaires' },
        { id: 'livraison', name: 'Livraison à Domicile', priority: 2, desc: 'Intégration Uber Eats, Deliveroo, Just Eat' },
        { id: 'click_collect', name: 'Click & Collect', priority: 2, desc: 'Commande web et retrait sur place' }
    ],
    pizzeria: [
        { id: 'menu_pizzas', name: 'Menu Pizzas Interactif', priority: 1, desc: 'Personnalisation taille, ingrédients, prix' },
        { id: 'commande_ligne', name: 'Commande en Ligne', priority: 1, desc: 'Interface de commande intuitive et rapide' },
        { id: 'livraison', name: 'Gestion Livraison', priority: 1, desc: 'Zones, délais, tracking en temps réel' },
        { id: 'click_collect', name: 'Click & Collect', priority: 1, desc: 'Commande et retrait, temps d\'attente' },
        { id: 'paiement_ligne', name: 'Paiement en Ligne', priority: 1, desc: 'CB, PayPal, Chèques déjeuner, Apple Pay' },
        { id: 'personnalisation', name: 'Créateur de Pizza', priority: 2, desc: 'Interface visuelle pour composer sa pizza' },
        { id: 'promotion_combo', name: 'Promotions & Combos', priority: 2, desc: 'Offres groupées et menus famille' },
        { id: 'temps_attente', name: 'Temps d\'Attente Temps Réel', priority: 2, desc: 'Estimation dynamique de préparation' },
        { id: 'fidelite', name: 'Carte Fidélité', priority: 2, desc: 'Points et 10ème pizza gratuite' },
        { id: 'planning_fours', name: 'Planning des Fours', priority: 2, desc: 'Optimisation production et cadence' },
        { id: 'stock_ingredients', name: 'Stock Ingrédients', priority: 2, desc: 'Gestion pâte, fromage, garnitures' },
        { id: 'avis_clients', name: 'Avis Clients', priority: 3, desc: 'Notation et commentaires avec photos' },
        { id: 'multi_tailles', name: 'Multi-tailles', priority: 3, desc: 'Gestion prix selon taille (S/M/L/XL)' },
        { id: 'zone_livraison', name: 'Zones de Livraison', priority: 2, desc: 'Délimitation géographique et tarifs' },
        { id: 'tracking_commande', name: 'Suivi Commande', priority: 2, desc: 'Statut en temps réel pour le client' }
    ],
    coiffeur: [
        { id: 'planning_rdv', name: 'Planning Rendez-vous', priority: 1, desc: 'Réservation en ligne 24h/24 automatisée' },
        { id: 'gestion_coiffeurs', name: 'Gestion Coiffeurs', priority: 1, desc: 'Planning par coiffeur et spécialités' },
        { id: 'catalogue_coupes', name: 'Catalogue Coupes', priority: 1, desc: 'Photos avant/après, descriptions détaillées' },
        { id: 'tarifs_services', name: 'Grille Tarifaire', priority: 1, desc: 'Prix selon longueur, type de service' },
        { id: 'fiche_client', name: 'Fiche Client', priority: 1, desc: 'Historique, préférences, allergies colorations' },
        { id: 'stock_produits', name: 'Stock Produits', priority: 2, desc: 'Shampoings, colorations, soins, accessoires' },
        { id: 'rappel_rdv', name: 'Rappels Automatiques', priority: 2, desc: 'SMS/Email 24h avant + confirmations' },
        { id: 'programme_fidelite', name: 'Programme Fidélité', priority: 2, desc: '10ème coupe gratuite + avantages VIP' },
        { id: 'conseils_beaute', name: 'Conseils Beauté', priority: 2, desc: 'Tips personnalisés selon type cheveux' },
        { id: 'vente_produits', name: 'Vente Produits', priority: 2, desc: 'E-commerce produits capillaires professionnels' },
        { id: 'avant_apres', name: 'Galerie Avant/Après', priority: 2, desc: 'Portfolio transformations avec autorisation' },
        { id: 'colorimetre', name: 'Nuancier Couleurs', priority: 3, desc: 'Palette interactive 200+ couleurs' },
        { id: 'temps_services', name: 'Durée Services', priority: 3, desc: 'Estimation temps par prestation' },
        { id: 'avis_clients', name: 'Avis Clients', priority: 3, desc: 'Notation 5 étoiles et témoignages' }
    ],
    garage: [
        { id: 'devis_ligne', name: 'Devis en Ligne', priority: 1, desc: 'Estimation automatique selon marque/modèle/année' },
        { id: 'planning_reparations', name: 'Planning Réparations', priority: 1, desc: 'Gestion créneaux atelier et mécaniciens' },
        { id: 'fiche_vehicule', name: 'Fiche Véhicule', priority: 1, desc: 'Historique complet entretien/réparations' },
        { id: 'factures_auto', name: 'Facturation Automatique', priority: 1, desc: 'Génération factures détaillées avec TVA' },
        { id: 'suivi_reparation', name: 'Suivi Réparation', priority: 1, desc: 'Étapes travaux en cours pour le client' },
        { id: 'diagnostic_auto', name: 'Diagnostic Automatique', priority: 2, desc: 'Interface OBD, lecture codes erreur' },
        { id: 'stock_pieces', name: 'Stock Pièces Détachées', priority: 2, desc: 'Inventaire 10000+ références constructeurs' },
        { id: 'rappel_controle', name: 'Rappel Contrôle Technique', priority: 2, desc: 'Alertes échéances par SMS/Email' },
        { id: 'garanties', name: 'Gestion Garanties', priority: 2, desc: 'Suivi garanties pièces et main d\'œuvre' },
        { id: 'expertise', name: 'Expertise Assurance', priority: 2, desc: 'Rapports d\'expertise avec photos détaillées' },
        { id: 'geo_depannage', name: 'Géolocalisation Dépannage', priority: 2, desc: 'Service dépannage mobile 24h/24' },
        { id: 'carnet_entretien', name: 'Carnet d\'Entretien Digital', priority: 3, desc: 'Historique numérique personnalisé' },
        { id: 'alerte_revision', name: 'Alertes Révision', priority: 3, desc: 'Rappels automatiques selon kilométrage' }
    ],
    boutique: [
        { id: 'catalogue_produits', name: 'Catalogue Produits', priority: 1, desc: 'Photos HD 360°, descriptions détaillées' },
        { id: 'gestion_tailles', name: 'Gestion Tailles/Couleurs', priority: 1, desc: 'Variantes produits avec stock temps réel' },
        { id: 'stock_temps_reel', name: 'Stock Temps Réel', priority: 1, desc: 'Disponibilité instantanée et réservations' },
        { id: 'click_collect', name: 'Click & Collect', priority: 1, desc: 'Commande web, retrait magasin 2h' },
        { id: 'paiement_securise', name: 'Paiement Sécurisé', priority: 1, desc: 'CB, PayPal, Klarna, Apple Pay, Google Pay' },
        { id: 'programme_vip', name: 'Programme VIP', priority: 2, desc: 'Clients privilégiés, ventes privées, avantages' },
        { id: 'lookbook', name: 'Lookbook Saisonnier', priority: 2, desc: 'Inspiration mode, tendances, style guides' },
        { id: 'essayage_virtuel', name: 'Essayage Virtuel', priority: 2, desc: 'Réalité augmentée pour vêtements/accessoires' },
        { id: 'personal_shopper', name: 'Personal Shopper', priority: 2, desc: 'Conseil style personnalisé par chat/vidéo' },
        { id: 'alertes_stock', name: 'Alertes Stock', priority: 2, desc: 'Notifications réapprovisionnement automatiques' },
        { id: 'promotions_auto', name: 'Promotions Automatiques', priority: 2, desc: 'Soldes, réductions ciblées par profil client' },
        { id: 'wishlist', name: 'Liste de Souhaits', priority: 3, desc: 'Produits favoris avec alertes prix/stock' },
        { id: 'recommandations', name: 'Recommandations IA', priority: 2, desc: 'Suggestions personnalisées machine learning' },
        { id: 'tailles_guide', name: 'Guide des Tailles', priority: 3, desc: 'Correspondances internationales et conseils' },
        { id: 'retours_echanges', name: 'Gestion Retours', priority: 2, desc: 'Politique retour/échange 30 jours' },
        { id: 'carte_fidelite', name: 'Carte Fidélité', priority: 2, desc: 'Points, cashback, paliers avantages' },
        { id: 'nouveautes', name: 'Alertes Nouveautés', priority: 3, desc: 'Notifications nouvelles collections par profil' }
    ],
    institut: [
        { id: 'planning_soins', name: 'Planning Soins', priority: 1, desc: 'Réservation selon type soin et esthéticienne' },
        { id: 'fiche_beaute', name: 'Fiche Beauté Client', priority: 1, desc: 'Type peau, allergies, historique complet soins' },
        { id: 'catalogue_soins', name: 'Catalogue Soins', priority: 1, desc: 'Descriptions détaillées, durées, tarifs, résultats' },
        { id: 'produits_conseilles', name: 'Produits Conseillés', priority: 1, desc: 'Recommandations personnalisées post-soin' },
        { id: 'rappel_rdv', name: 'Rappels RDV', priority: 1, desc: 'SMS/Email automatiques 24h avant' },
        { id: 'diagnostic_peau', name: 'Diagnostic Peau IA', priority: 2, desc: 'Analyse personnalisée avec caméra HD' },
        { id: 'avant_apres', name: 'Galerie Avant/Après', priority: 2, desc: 'Portfolio résultats avec autorisation clients' },
        { id: 'forfaits_soins', name: 'Forfaits Soins', priority: 2, desc: 'Packages multi-séances avec économies' },
        { id: 'tendances_beaute', name: 'Tendances Beauté', priority: 2, desc: 'Actualités, conseils saison, nouveautés' },
        { id: 'programme_fidelite', name: 'Programme Fidélité', priority: 2, desc: 'Points cumulés, soins gratuits, privilèges' },
        { id: 'certification_bio', name: 'Certifications Bio', priority: 3, desc: 'Labels produits naturels et bio' },
        { id: 'equipe_esthetiques', name: 'Équipe Esthéticiennes', priority: 3, desc: 'Profils détaillés, spécialités, formations' },
        { id: 'conseils_maison', name: 'Conseils Maison', priority: 3, desc: 'Routine beauté quotidienne personnalisée' },
        { id: 'reservation_duo', name: 'Réservation Duo/Groupe', priority: 2, desc: 'Soins simultanés entre amies/couples' },
        { id: 'carte_cadeau', name: 'Carte Cadeau', priority: 2, desc: 'Bons cadeaux dématérialisés personnalisés' },
        { id: 'suivi_resultats', name: 'Suivi Résultats', priority: 2, desc: 'Photos évolution, mesures, conseils adaptation' }
    ],
    boulangerie: [
        { id: 'catalogue_pain', name: 'Catalogue Pains & Viennoiseries', priority: 1, desc: 'Photos HD, ingrédients, valeurs nutritionnelles' },
        { id: 'commande_avance', name: 'Commande à l\'Avance', priority: 1, desc: 'Réservation pains spéciaux, gâteaux personnalisés' },
        { id: 'production_jour', name: 'Production du Jour', priority: 1, desc: 'Disponibilité temps réel, quantités restantes' },
        { id: 'allergenes', name: 'Gestion Allergènes', priority: 1, desc: 'Traçabilité complète gluten, lactose, fruits à coque' },
        { id: 'horaires_cuisson', name: 'Horaires de Cuisson', priority: 1, desc: 'Pain chaud selon heures, notifications clients' },
        { id: 'fidelite_baguette', name: 'Carte Baguette', priority: 2, desc: '10 baguettes achetées = 1 gratuite' },
        { id: 'commande_fetes', name: 'Commandes Fêtes', priority: 2, desc: 'Gâteaux anniversaire, pièces montées sur mesure' },
        { id: 'ingredients_bio', name: 'Traçabilité Bio', priority: 2, desc: 'Origine ingrédients biologiques et locaux' },
        { id: 'nutritionnel', name: 'Valeurs Nutritionnelles', priority: 3, desc: 'Calories, composition, index glycémique' },
        { id: 'sandwicherie', name: 'Sandwicherie', priority: 2, desc: 'Sandwichs sur mesure avec ingrédients frais' },
        { id: 'click_collect', name: 'Click & Collect', priority: 2, desc: 'Commande en ligne, retrait prioritaire' },
        { id: 'abonnement_pain', name: 'Abonnement Pain', priority: 2, desc: 'Livraison régulière domicile/bureau' }
    ],
    pharmacie: [
        { id: 'stock_medicaments', name: 'Stock Médicaments', priority: 1, desc: 'Disponibilité 15000+ références temps réel' },
        { id: 'ordonnances_ligne', name: 'Ordonnances en Ligne', priority: 1, desc: 'Photo ordonnance, préparation automatique' },
        { id: 'dossier_patient', name: 'Dossier Patient Sécurisé', priority: 1, desc: 'Historique, allergies, interactions médicamenteuses' },
        { id: 'tiers_payant', name: 'Tiers Payant', priority: 1, desc: 'Gestion automatique remboursements mutuelles' },
        { id: 'click_collect', name: 'Click & Collect', priority: 1, desc: 'Préparation commandes, retrait prioritaire' },
        { id: 'rappel_medicaments', name: 'Rappel Prise Médicaments', priority: 2, desc: 'Alertes horaires personnalisées par SMS' },
        { id: 'generiques', name: 'Propositions Génériques', priority: 2, desc: 'Alternatives moins chères avec accord patient' },
        { id: 'garde_pharmacie', name: 'Pharmacies de Garde', priority: 3, desc: 'Géolocalisation urgences 24h/24' },
        { id: 'conseil_sante', name: 'Conseils Santé', priority: 2, desc: 'Fiches pathologies, automédication responsable' },
        { id: 'parapharmacie', name: 'Parapharmacie', priority: 2, desc: 'Cosmétiques, compléments, matériel médical' },
        { id: 'vaccination', name: 'Suivi Vaccination', priority: 2, desc: 'Calendrier vaccinal, rappels automatiques' }
    ],
    pressing: [
        { id: 'systeme_tickets', name: 'Système Tickets QR', priority: 1, desc: 'QR codes uniques, étiquetage automatique' },
        { id: 'tarifs_services', name: 'Grille Tarifaire', priority: 1, desc: 'Prix selon vêtement, matière, service' },
        { id: 'suivi_vetements', name: 'Suivi Vêtements', priority: 1, desc: 'Étapes nettoyage en temps réel' },
        { id: 'notification_pret', name: 'Notification Prêt', priority: 1, desc: 'SMS/Email automatique quand prêt' },
        { id: 'urgences', name: 'Service Urgences', priority: 1, desc: 'Nettoyage express 24h avec supplément' },
        { id: 'collecte_domicile', name: 'Collecte à Domicile', priority: 2, desc: 'Service ramassage/livraison sur RDV' },
        { id: 'retouches', name: 'Retouches Couture', priority: 2, desc: 'Ourlets, réparations, ajustements' },
        { id: 'specialites', name: 'Spécialités Textiles', priority: 2, desc: 'Cuir, fourrure, robes de mariée' },
        { id: 'carte_fidelite', name: 'Carte Fidélité', priority: 2, desc: '10ème nettoyage gratuit + remises VIP' }
    ],
    opticien: [
        { id: 'catalogue_montures', name: 'Catalogue Montures', priority: 1, desc: 'Photos 360°, 500+ modèles, filtres avancés' },
        { id: 'ordonnance_ligne', name: 'Ordonnance en Ligne', priority: 1, desc: 'Upload prescription, vérification automatique' },
        { id: 'verres_options', name: 'Configurateur Verres', priority: 1, desc: 'Anti-reflet, progressifs, photochromiques' },
        { id: 'tiers_payant', name: 'Tiers Payant', priority: 1, desc: 'Mutuelle, sécurité sociale, remboursements' },
        { id: 'garanties', name: 'Garanties Montures', priority: 1, desc: 'Casse, rayures, adaptation gratuite' },
        { id: 'essayage_virtuel', name: 'Essayage Virtuel AR', priority: 2, desc: 'Réalité augmentée pour tester montures' },
        { id: 'controle_vue', name: 'Contrôle de Vue', priority: 2, desc: 'Prise RDV ophtalmologue partenaire' },
        { id: 'lentilles', name: 'Gestion Lentilles', priority: 2, desc: 'Commande, abonnement, rappels renouvellement' },
        { id: 'solaires', name: 'Lunettes Solaires', priority: 2, desc: 'Collection été, verres correcteurs solaires' },
        { id: 'enfants', name: 'Section Enfants', priority: 3, desc: 'Montures adaptées, incassables, colorées' }
    ],
    fleuriste: [
        { id: 'catalogue_fleurs', name: 'Catalogue Fleurs', priority: 1, desc: 'Photos HD saisonnières, disponibilités temps réel' },
        { id: 'compositions', name: 'Compositions Personnalisées', priority: 1, desc: 'Créateur bouquets interactif, preview 3D' },
        { id: 'livraison_express', name: 'Livraison Express', priority: 1, desc: 'Même jour, créneaux 2h, géolocalisation' },
        { id: 'evenements', name: 'Fleurs Événements', priority: 1, desc: 'Mariages, deuil, fêtes, devis personnalisés' },
        { id: 'conseil_entretien', name: 'Conseils Entretien', priority: 1, desc: 'Guides prolonger durée de vie par type' },
        { id: 'abonnement', name: 'Abonnement Fleurs', priority: 2, desc: 'Livraison hebdo/mensuelle, surprises saisonnières' },
        { id: 'plantes_vertes', name: 'Plantes Vertes', priority: 2, desc: 'Intérieur, extérieur, conseils jardinage' },
        { id: 'carte_message', name: 'Cartes & Messages', priority: 3, desc: 'Personnalisation messages, calligraphie' }
    ],
    dentiste: [
        { id: 'planning_rdv', name: 'Planning Rendez-vous', priority: 1, desc: 'Créneaux selon urgence, type soin, praticien' },
        { id: 'dossier_dentaire', name: 'Dossier Dentaire', priority: 1, desc: 'Historique complet, radios, schémas dentaires' },
        { id: 'devis_soins', name: 'Devis Soins', priority: 1, desc: 'Estimations prothèses, implants, remboursements' },
        { id: 'tiers_payant', name: 'Tiers Payant', priority: 1, desc: 'Mutuelle, CMU, remboursements automatiques' },
        { id: 'urgences', name: 'Urgences Dentaires', priority: 1, desc: 'Créneaux prioritaires, garde weekend' },
        { id: 'rappel_controle', name: 'Rappel Contrôle', priority: 2, desc: 'Détartrage annuel, check-up préventif' },
        { id: 'conseils_hygiene', name: 'Conseils Hygiène', priority: 2, desc: 'Vidéos brossage, prévention personnalisée' },
        { id: 'orthodontie', name: 'Suivi Orthodontie', priority: 2, desc: 'Appareils, ajustements, photos évolution' },
        { id: 'radiologie', name: 'Radiologie Intégrée', priority: 2, desc: 'Panoramiques, scanners 3D, CBCT' },
        { id: 'pediatrie', name: 'Dentisterie Pédiatrique', priority: 2, desc: 'Soins adaptés enfants, jeux éducatifs' },
        { id: 'esthetique', name: 'Dentisterie Esthétique', priority: 2, desc: 'Blanchiment, facettes, sourire design' },
        { id: 'anesthesie', name: 'Gestion Anesthésie', priority: 3, desc: 'Protocoles, allergies, sédation consciente' }
    ]
};

// Photos HD par métier
const businessPhotos = {
    restaurant: [
        'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800&h=600&fit=crop&crop=center',
        'https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=800&h=600&fit=crop&crop=center',
        'https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?w=800&h=600&fit=crop&crop=center'
    ],
    pizzeria: [
        'https://images.unsplash.com/photo-1513104890138-7c749659a591?w=800&h=600&fit=crop&crop=center',
        'https://images.unsplash.com/photo-1571407970349-bc81e7e96d47?w=800&h=600&fit=crop&crop=center'
    ],
    coiffeur: [
        'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=800&h=600&fit=crop&crop=center',
        'https://images.unsplash.com/photo-1522336572468-97b06e8ef143?w=800&h=600&fit=crop&crop=center'
    ],
    boutique: [
        'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=800&h=600&fit=crop&crop=center',
        'https://images.unsplash.com/photo-1472851294608-062f824d29cc?w=800&h=600&fit=crop&crop=center'
    ],
    garage: [
        'https://images.unsplash.com/photo-1486262715619-67b85e0b08d3?w=800&h=600&fit=crop&crop=center'
    ],
    institut: [
        'https://images.unsplash.com/photo-1540555700478-4be289fbecef?w=800&h=600&fit=crop&crop=center'
    ],
    boulangerie: [
        'https://images.unsplash.com/photo-1509440159596-0249088772ff?w=800&h=600&fit=crop&crop=center'
    ],
    pharmacie: [
        'https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?w=800&h=600&fit=crop&crop=center'
    ],
    pressing: [
        'https://images.unsplash.com/photo-1567401893414-76b7b1e5a7a5?w=800&h=600&fit=crop&crop=center'
    ],
    opticien: [
        'https://images.unsplash.com/photo-1574258495973-f010dfbb5371?w=800&h=600&fit=crop&crop=center'
    ],
    fleuriste: [
        'https://images.unsplash.com/photo-1490750967868-88aa4486c946?w=800&h=600&fit=crop&crop=center'
    ],
    dentiste: [
        'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=800&h=600&fit=crop&crop=center'
    ]
};

// ===== FONCTIONS PRINCIPALES =====

function selectBusiness(business) {
    selectedBusiness = business;
    businessData.type = business;
    
    // Mettre à jour l'interface
    document.querySelectorAll('.business-card').forEach(card => card.classList.remove('selected'));
    event.target.closest('.business-card').classList.add('selected');
    
    // Afficher le formulaire d'info
    document.getElementById('business-info').style.display = 'block';
    document.getElementById('business-info').scrollIntoView({ behavior: 'smooth' });
    
    validateBusinessInfo();
}

function validateBusinessInfo() {
    const name = document.getElementById('businessName').value;
    const city = document.getElementById('businessCity').value;
    const isValid = name.length > 2 && city.length > 2;
    
    document.getElementById('continueBtn').disabled = !isValid;
}

function showPlans() {
    // Collecter les infos
    businessData.name = document.getElementById('businessName').value;
    businessData.city = document.getElementById('businessCity').value;
    
    // Passer à la phase plans
    showPhase('plan-selection');
}

function selectPlan(plan) {
    selectedPlan = plan;
    
    // Mettre à jour l'interface
    document.querySelectorAll('.plan-card').forEach(card => card.classList.remove('selected'));
    event.target.closest('.plan-card').classList.add('selected');
    
    document.getElementById('planContinueBtn').disabled = false;
}

function showOptionSelection() {
    // Mettre à jour l'affichage
    document.getElementById('businessTypeDisplay').textContent = 
        selectedBusiness.charAt(0).toUpperCase() + selectedBusiness.slice(1);
    
    document.getElementById('selectedPlanDisplay').textContent = pricingPlans[selectedPlan].name;
    
    const plan = pricingPlans[selectedPlan];
    document.getElementById('planDescription').textContent = 
        plan.includedCount === 999 ? 'Toutes options incluses' : 
        `${plan.includedCount} options incluses + ${plan.additionalCount} options au choix`;
    
    // Passer à la phase options
    showPhase('options-selection');
    
    // Générer les options
    generateOptionsGrids();
    updatePlanSummary();
}

function generateOptionsGrids() {
    const allOptions = businessOptions[selectedBusiness] || [];
    const plan = pricingPlans[selectedPlan];
    
    // Options incluses (les plus prioritaires)
    const includedOptions = allOptions
        .sort((a, b) => a.priority - b.priority)
        .slice(0, plan.includedCount === 999 ? allOptions.length : plan.includedCount);
    
    businessData.includedOptions = includedOptions.map(opt => opt.id);
    
    // Générer grille options incluses
    const includedGrid = document.getElementById('includedOptionsGrid');
    includedGrid.innerHTML = includedOptions.map(option => `
        <div class="option-item bg-green-50 border-2 border-green-200 rounded-lg p-4">
            <div class="flex items-start justify-between mb-2">
                <h4 class="font-semibold text-sm text-green-800">${option.name}</h4>
                <div class="text-sm font-bold text-green-600">INCLUS</div>
            </div>
            <p class="text-xs text-green-700">${option.desc}</p>
            <div class="mt-2 flex items-center justify-between">
                <span class="text-xs bg-green-200 text-green-800 px-2 py-1 rounded">Inclus dans ${pricingPlans[selectedPlan].name}</span>
                <i class="fas fa-check text-green-600"></i>
            </div>
        </div>
    `).join('');
    
    // Options supplémentaires (si pas PRO)
    if (selectedPlan !== 'pro') {
        const additionalOptions = allOptions.filter(opt => !includedOptions.includes(opt));
        
        document.getElementById('additionalOptionsSection').style.display = 'block';
        document.getElementById('additionalOptionsCounter').textContent = 
            `(0/${plan.additionalCount} sélectionnées)`;
        
        const additionalGrid = document.getElementById('additionalOptionsGrid');
        additionalGrid.innerHTML = additionalOptions.map(option => `
            <div class="option-item border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-blue-300 transition-all" onclick="toggleAdditionalOption('${option.id}')">
                <div class="flex items-start justify-between mb-2">
                    <h4 class="font-semibold text-sm">${option.name}</h4>
                    <div class="text-sm font-bold text-gray-400">OPTION</div>
                </div>
                <p class="text-xs text-gray-600">${option.desc}</p>
                <div class="mt-2 flex items-center justify-between">
                    <span class="text-xs bg-gray-100 px-2 py-1 rounded">Option supplémentaire</span>
                    <i class="fas fa-plus text-gray-400"></i>
                </div>
            </div>
        `).join('');
    } else {
        document.getElementById('additionalOptionsSection').style.display = 'none';
    }
}

function toggleAdditionalOption(optionId) {
    const plan = pricingPlans[selectedPlan];
    const element = event.target.closest('.option-item');
    const index = businessData.additionalOptions.indexOf(optionId);
    
    if (index === -1 && businessData.additionalOptions.length < plan.additionalCount) {
        // Ajouter l'option
        businessData.additionalOptions.push(optionId);
        element.classList.add('selected', 'border-blue-500', 'bg-blue-50');
        element.querySelector('.fa-plus').className = 'fas fa-check text-blue-600';
        element.querySelector('.text-gray-400').textContent = 'CHOISI';
        element.querySelector('.text-gray-400').className = 'text-sm font-bold text-blue-600';
    } else if (index !== -1) {
        // Retirer l'option
        businessData.additionalOptions.splice(index, 1);
        element.classList.remove('selected', 'border-blue-500', 'bg-blue-50');
        element.querySelector('.fa-check').className = 'fas fa-plus text-gray-400';
        element.querySelector('.text-blue-600').textContent = 'OPTION';
        element.querySelector('.text-blue-600').className = 'text-sm font-bold text-gray-400';
    }
    
    // Mettre à jour le compteur
    document.getElementById('additionalOptionsCounter').textContent = 
        `(${businessData.additionalOptions.length}/${plan.additionalCount} sélectionnées)`;
}

function updatePlanSummary() {
    const plan = pricingPlans[selectedPlan];
    
    document.getElementById('currentPlanName').textContent = `💰 Plan ${plan.name}`;
    document.getElementById('planPrice').textContent = `${plan.price}€`;
    
    const featuresList = document.getElementById('planFeaturesList');
    featuresList.innerHTML = plan.features.map(feature => `
        <div class="flex items-center">
            <i class="fas fa-check text-green-500 mr-2"></i>
            <span>${feature}</span>
        </div>
    `).join('');
}

function selectStyle(style, primary, secondary) {
    businessData.style = style;
    businessData.primaryColor = primary;
    businessData.secondaryColor = secondary;
    
    // Mettre à jour les color pickers
    document.getElementById('primaryColor').value = primary;
    document.getElementById('secondaryColor').value = secondary;
    
    // Mettre à jour l'interface
    document.querySelectorAll('.style-card').forEach(card => card.classList.remove('selected'));
    event.target.closest('.style-card').classList.add('selected');
}

function updateColors() {
    businessData.primaryColor = document.getElementById('primaryColor').value;
    businessData.secondaryColor = document.getElementById('secondaryColor').value;
    
    // Désélectionner les styles prédéfinis
    document.querySelectorAll('.style-card').forEach(card => card.classList.remove('selected'));
}

function resetColors() {
    businessData.primaryColor = '#3B82F6';
    businessData.secondaryColor = '#1E40AF';
    document.getElementById('primaryColor').value = '#3B82F6';
    document.getElementById('secondaryColor').value = '#1E40AF';
}

function generateTemplates() {
    // Passer à la phase de génération
    showPhase('templates-generated');
    
    // Mettre à jour les infos finales
    document.getElementById('finalBusinessName').textContent = businessData.name;
    document.getElementById('finalPriceDisplay').textContent = `${pricingPlans[selectedPlan].price}€/mois`;
    document.getElementById('totalOptionsCount').textContent = 
        `${businessData.includedOptions.length + businessData.additionalOptions.length} fonctionnalités`;
    
    // Générer les templates avec délai pour l'effet
    setTimeout(() => {
        generateManagerTemplate();
    }, 1000);
    
    setTimeout(() => {
        generateClientTemplate();
    }, 2000);
    
    setTimeout(() => {
        updateFeaturesLists();
    }, 3000);
}

function generateManagerTemplate() {
    const photos = businessPhotos[selectedBusiness] || businessPhotos.restaurant;
    
    const managerHTML = `
        <div class="bg-white rounded-lg overflow-hidden shadow-lg" onclick="previewTemplate('manager')">
            <!-- Header Manager avec glassmorphisme -->
            <div class="p-6 relative overflow-hidden" style="background: linear-gradient(135deg, ${businessData.primaryColor}, ${businessData.secondaryColor});">
                <div class="absolute inset-0 bg-white bg-opacity-10 backdrop-blur-sm"></div>
                <div class="relative flex items-center text-white">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-4 backdrop-blur-sm">
                        <i class="fas fa-chart-line text-xl"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg">${businessData.name} - Manager</h3>
                        <p class="text-sm opacity-90">Interface de gestion premium</p>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Premium -->
            <div class="p-6 bg-gradient-to-br from-gray-50 to-white">
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="bg-gradient-to-r from-green-400 to-green-500 p-4 rounded-xl text-white text-center shadow-lg">
                        <div class="text-2xl font-bold">247</div>
                        <div class="text-xs opacity-90">Clients Actifs</div>
                    </div>
                    <div class="bg-gradient-to-r from-blue-400 to-blue-500 p-4 rounded-xl text-white text-center shadow-lg">
                        <div class="text-2xl font-bold">1,2k€</div>
                        <div class="text-xs opacity-90">CA Aujourd'hui</div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-400 to-purple-500 p-4 rounded-xl text-white text-center shadow-lg">
                        <div class="text-2xl font-bold">89%</div>
                        <div class="text-xs opacity-90">Satisfaction</div>
                    </div>
                </div>
                
                <!-- Navigation Premium -->
                <div class="space-y-3">
                    ${getManagerNavigation()}
                </div>
                
                <!-- Quick Actions Premium -->
                <div class="mt-6 grid grid-cols-2 gap-3">
                    <button class="p-3 rounded-xl text-white text-sm font-semibold shadow-lg transform hover:scale-105 transition-all" style="background: linear-gradient(135deg, ${businessData.primaryColor}, ${businessData.secondaryColor});">
                        <i class="fas fa-plus mr-2"></i>Nouveau
                    </button>
                    <button class="p-3 bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-xl text-sm font-semibold shadow-lg transform hover:scale-105 transition-all">
                        <i class="fas fa-chart-bar mr-2"></i>Analytics
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('managerPreview').innerHTML = managerHTML;
}

function generateClientTemplate() {
    const photos = businessPhotos[selectedBusiness] || businessPhotos.restaurant;
    
    const clientHTML = `
        <div class="bg-white rounded-lg overflow-hidden shadow-lg" onclick="previewTemplate('client')">
            <!-- Hero Section Premium -->
            <div class="relative h-40 overflow-hidden">
                <img src="${photos[0]}" class="w-full h-full object-cover transform hover:scale-110 transition-transform duration-500">
                <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
                <div class="absolute bottom-4 left-4 text-white">
                    <h2 class="text-xl font-bold">${businessData.name}</h2>
                    <p class="text-sm opacity-90 flex items-center">
                        <i class="fas fa-map-marker-alt mr-1"></i>${businessData.city}
                    </p>
                </div>
                <div class="absolute top-4 right-4">
                    <div class="bg-white bg-opacity-20 backdrop-blur-sm rounded-full p-2">
                        <i class="fas fa-heart text-white"></i>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Premium -->
            <div class="p-6">
                <!-- Quick Actions Premium -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <button class="p-4 rounded-xl text-white font-semibold text-sm shadow-lg transform hover:scale-105 transition-all" style="background: linear-gradient(135deg, ${businessData.primaryColor}, ${businessData.secondaryColor});">
                        <i class="fas fa-${getClientMainIcon()} mr-2"></i>
                        ${getClientMainAction()}
                    </button>
                    <button class="p-4 border-2 rounded-xl font-semibold text-sm shadow-lg transform hover:scale-105 transition-all" style="border-color: ${businessData.secondaryColor}; color: ${businessData.secondaryColor};">
                        <i class="fas fa-info-circle mr-2"></i>
                        Découvrir
                    </button>
                </div>
                
                <!-- Features Grid Premium -->
                <div class="space-y-3">
                    ${getClientFeaturesList()}
                </div>
                
                <!-- Rating & Contact Premium -->
                <div class="mt-6 p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl border border-orange-200">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center">
                            <div class="flex text-yellow-500 mr-2">
                                ${'★'.repeat(5)}
                            </div>
                            <span class="text-sm font-semibold">4.9/5</span>
                        </div>
                        <span class="text-xs text-gray-500">127 avis</span>
                    </div>
                    <div class="text-xs text-gray-600">
                        <i class="fas fa-phone mr-1"></i>06 12 34 56 78
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('clientPreview').innerHTML = clientHTML;
}

function getManagerNavigation() {
    const navItems = {
        restaurant: ['Dashboard', 'Réservations', 'Menu Digital', 'Commandes', 'Stock', 'Équipe', 'Analytics'],
        pizzeria: ['Dashboard', 'Commandes', 'Menu Pizzas', 'Livraisons', 'Stock', 'Analytics'],
        coiffeur: ['Dashboard', 'Rendez-vous', 'Clients', 'Services', 'Équipe', 'Stock', 'Analytics'],
        garage: ['Dashboard', 'Réparations', 'Devis', 'Véhicules', 'Stock Pièces', 'Planning'],
        boutique: ['Dashboard', 'Produits', 'Commandes', 'Stock', 'Clients', 'Promotions'],
        institut: ['Dashboard', 'Rendez-vous', 'Clients', 'Soins', 'Produits', 'Analytics'],
        boulangerie: ['Dashboard', 'Production', 'Commandes', 'Stock', 'Clients', 'Analytics'],
        pharmacie: ['Dashboard', 'Ordonnances', 'Stock', 'Patients', 'Tiers Payant', 'Analytics'],
        pressing: ['Dashboard', 'Tickets', 'Suivi', 'Clients', 'Tarifs', 'Analytics'],
        opticien: ['Dashboard', 'Montures', 'Ordonnances', 'Clients', 'Stock', 'Analytics'],
        fleuriste: ['Dashboard', 'Compositions', 'Livraisons', 'Événements', 'Stock', 'Analytics'],
        dentiste: ['Dashboard', 'Rendez-vous', 'Patients', 'Soins', 'Devis', 'Analytics']
    };
    
    const items = navItems[selectedBusiness] || navItems.restaurant;
    
    return items.slice(0, 6).map(item => `
        <div class="flex items-center p-3 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 rounded-lg cursor-pointer transition-all group">
            <div class="w-8 h-8 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-lg flex items-center justify-center mr-3 group-hover:from-blue-200 group-hover:to-indigo-200 transition-all">
                <i class="fas fa-chevron-right text-blue-600 text-xs"></i>
            </div>
            <span class="text-sm font-medium">${item}</span>
        </div>
    `).join('');
}

function getClientMainIcon() {
    const icons = {
        restaurant: 'utensils',
        pizzeria: 'pizza-slice',
        coiffeur: 'cut',
        garage: 'car',
        boutique: 'shopping-bag',
        institut: 'spa',
        boulangerie: 'bread-slice',
        pharmacie: 'pills',
        pressing: 'tshirt',
        opticien: 'glasses',
        fleuriste: 'seedling',
        dentiste: 'tooth'
    };
    return icons[selectedBusiness] || 'store';
}

function getClientMainAction() {
    const actions = {
        restaurant: 'Réserver Table',
        pizzeria: 'Commander',
        coiffeur: 'Prendre RDV',
        garage: 'Demander Devis',
        boutique: 'Voir Catalogue',
        institut: 'Réserver Soin',
        boulangerie: 'Commander',
        pharmacie: 'Envoyer Ordonnance',
        pressing: 'Déposer Linge',
        opticien: 'Essayer Montures',
        fleuriste: 'Composer Bouquet',
        dentiste: 'Prendre RDV'
    };
    return actions[selectedBusiness] || 'Découvrir';
}

function getClientFeaturesList() {
    // Prendre les 4 premières options sélectionnées (incluses + additionnelles)
    const allSelectedOptions = [...businessData.includedOptions, ...businessData.additionalOptions];
    const selectedFeatures = allSelectedOptions.slice(0, 4);
    const allOptions = businessOptions[selectedBusiness] || [];
    
    return selectedFeatures.map(selectedId => {
        const option = allOptions.find(opt => opt.id === selectedId);
        if (!option) return '';
        
        return `
            <div class="flex items-center p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200">
                <div class="w-8 h-8 bg-gradient-to-r from-green-400 to-emerald-500 rounded-lg flex items-center justify-center mr-3">
                    <i class="fas fa-check text-white text-xs"></i>
                </div>
                <div>
                    <div class="text-sm font-semibold text-green-800">${option.name}</div>
                    <div class="text-xs text-green-600">${option.desc.slice(0, 50)}...</div>
                </div>
            </div>
        `;
    }).join('');
}

function updateFeaturesLists() {
    // Features Manager
    const allSelectedOptions = [...businessData.includedOptions, ...businessData.additionalOptions];
    const allOptions = businessOptions[selectedBusiness] || [];
    
    const managerFeatures = allSelectedOptions.map(optId => {
        const option = allOptions.find(o => o.id === optId);
        return option ? option.name : '';
    }).filter(name => name).slice(0, 6).join(' • ');
    
    document.getElementById('managerFeatures').textContent = managerFeatures || 'Gestion de base incluse';
    
    // Features Client
    const clientFeatures = allSelectedOptions.slice(0, 5).map(optId => {
        const option = allOptions.find(o => o.id === optId);
        return option ? option.name : '';
    }).filter(name => name).join(' • ');
    
    document.getElementById('clientFeatures').textContent = clientFeatures || 'Interface client de base';
}

function previewTemplate(type) {
    const modal = document.getElementById('fullPagePreview');
    const content = document.getElementById('previewContent');
    
    if (type === 'manager') {
        content.innerHTML = generateFullManagerPreview();
    } else {
        content.innerHTML = generateFullClientPreview();
    }
    
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function closePreview() {
    document.getElementById('fullPagePreview').style.display = 'none';
    document.body.style.overflow = 'auto';
}

function generateFullManagerPreview() {
    const photos = businessPhotos[selectedBusiness] || businessPhotos.restaurant;
    
    return `
        <div class="h-full bg-gradient-to-br from-gray-50 to-blue-50 overflow-auto">
            <!-- Header Premium -->
            <div class="bg-white shadow-lg border-b">
                <div class="max-w-7xl mx-auto px-6 py-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-xl flex items-center justify-center mr-4" style="background: linear-gradient(135deg, ${businessData.primaryColor}, ${businessData.secondaryColor});">
                                <i class="fas fa-${getClientMainIcon()} text-white text-xl"></i>
                            </div>
                            <div>
                                <h1 class="text-2xl font-bold text-gray-900">${businessData.name}</h1>
                                <p class="text-gray-600">Interface de gestion premium</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <button class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-all">
                                <i class="fas fa-bell text-gray-600"></i>
                            </button>
                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-500"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Content -->
            <div class="max-w-7xl mx-auto px-6 py-8">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-gradient-to-r from-green-400 to-green-500 rounded-xl flex items-center justify-center">
                                <i class="fas fa-users text-white text-xl"></i>
                            </div>
                            <span class="text-green-600 text-sm font-semibold">+12%</span>
                        </div>
                        <div class="text-3xl font-bold text-gray-900 mb-1">247</div>
                        <div class="text-gray-600 text-sm">Clients actifs</div>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-gradient-to-r from-blue-400 to-blue-500 rounded-xl flex items-center justify-center">
                                <i class="fas fa-euro-sign text-white text-xl"></i>
                            </div>
                            <span class="text-blue-600 text-sm font-semibold">+8%</span>
                        </div>
                        <div class="text-3xl font-bold text-gray-900 mb-1">1,247€</div>
                        <div class="text-gray-600 text-sm">CA aujourd'hui</div>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-gradient-to-r from-purple-400 to-purple-500 rounded-xl flex items-center justify-center">
                                <i class="fas fa-star text-white text-xl"></i>
                            </div>
                            <span class="text-purple-600 text-sm font-semibold">+5%</span>
                        </div>
                        <div class="text-3xl font-bold text-gray-900 mb-1">4.9</div>
                        <div class="text-gray-600 text-sm">Note moyenne</div>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-gradient-to-r from-orange-400 to-orange-500 rounded-xl flex items-center justify-center">
                                <i class="fas fa-chart-line text-white text-xl"></i>
                            </div>
                            <span class="text-orange-600 text-sm font-semibold">+15%</span>
                        </div>
                        <div class="text-3xl font-bold text-gray-900 mb-1">89%</div>
                        <div class="text-gray-600 text-sm">Satisfaction</div>
                    </div>
                </div>
                
                <!-- Main Content Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Options Activées -->
                    <div class="lg:col-span-2 bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Vos Options Actives</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${generateManagerOptionsDisplay()}
                        </div>
                    </div>
                    
                    <!-- Actions Rapides -->
                    <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Actions Rapides</h3>
                        <div class="space-y-3">
                            ${generateQuickActions()}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function generateFullClientPreview() {
    const photos = businessPhotos[selectedBusiness] || businessPhotos.restaurant;
    
    return `
        <div class="h-full bg-gray-50 overflow-auto">
            <!-- Hero Section -->
            <div class="relative h-80 overflow-hidden">
                <img src="${photos[0]}" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-black opacity-60"></div>
                <div class="absolute inset-0 flex items-center justify-center text-white text-center">
                    <div>
                        <h1 class="text-5xl font-bold mb-4">${businessData.name}</h1>
                        <p class="text-xl opacity-90 flex items-center justify-center">
                            <i class="fas fa-map-marker-alt mr-2"></i>${businessData.city}
                        </p>
                    </div>
                </div>
                <div class="absolute top-6 right-6">
                    <button class="bg-white bg-opacity-20 backdrop-blur-sm rounded-full p-3 hover:bg-opacity-30 transition-all">
                        <i class="fas fa-heart text-white text-xl"></i>
                    </button>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="max-w-6xl mx-auto px-6 py-8">
                <!-- Quick Actions -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <button class="p-6 rounded-2xl text-white font-bold text-lg shadow-xl transform hover:scale-105 transition-all" style="background: linear-gradient(135deg, ${businessData.primaryColor}, ${businessData.secondaryColor});">
                        <i class="fas fa-${getClientMainIcon()} mr-3 text-2xl"></i>
                        ${getClientMainAction()}
                    </button>
                    <button class="p-6 border-2 rounded-2xl font-bold text-lg shadow-xl transform hover:scale-105 transition-all bg-white" style="border-color: ${businessData.secondaryColor}; color: ${businessData.secondaryColor};">
                        <i class="fas fa-info-circle mr-3 text-2xl"></i>
                        Informations
                    </button>
                    <button class="p-6 bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-2xl font-bold text-lg shadow-xl transform hover:scale-105 transition-all">
                        <i class="fas fa-phone mr-3 text-2xl"></i>
                        Contacter
                    </button>
                </div>
                
                <!-- Services Grid -->
                <div class="bg-white rounded-2xl p-8 shadow-lg border border-gray-100 mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Nos Services</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${generateClientServicesDisplay()}
                    </div>
                </div>
                
                <!-- Reviews Section -->
                <div class="bg-white rounded-2xl p-8 shadow-lg border border-gray-100">
                    <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Avis Clients</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        ${generateReviewsDisplay()}
                    </div>
                </div>
            </div>
        </div>
    `;
}

function generateManagerOptionsDisplay() {
    const allSelectedOptions = [...businessData.includedOptions, ...businessData.additionalOptions];
    const allOptions = businessOptions[selectedBusiness] || [];
    
    return allSelectedOptions.slice(0, 8).map(optId => {
        const option = allOptions.find(o => o.id === optId);
        if (!option) return '';
        
        const isIncluded = businessData.includedOptions.includes(optId);
        
        return `
            <div class="p-4 rounded-xl border-2 ${isIncluded ? 'border-green-200 bg-green-50' : 'border-blue-200 bg-blue-50'}">
                <div class="flex items-center justify-between mb-2">
                    <h4 class="font-semibold text-sm ${isIncluded ? 'text-green-800' : 'text-blue-800'}">${option.name}</h4>
                    <div class="text-xs font-bold ${isIncluded ? 'text-green-600' : 'text-blue-600'}">
                        ${isIncluded ? 'INCLUS' : 'OPTION'}
                    </div>
                </div>
                <p class="text-xs ${isIncluded ? 'text-green-700' : 'text-blue-700'}">${option.desc}</p>
                <div class="mt-2 flex justify-end">
                    <i class="fas fa-cog ${isIncluded ? 'text-green-600' : 'text-blue-600'}"></i>
                </div>
            </div>
        `;
    }).join('');
}

function generateQuickActions() {
    const actions = {
        restaurant: ['Nouvelle Réservation', 'Gérer Menu', 'Voir Commandes', 'Analytics', 'Planning Équipe'],
        pizzeria: ['Nouvelle Commande', 'Gérer Menu Pizzas', 'Suivi Livraisons', 'Stock Ingrédients'],
        coiffeur: ['Nouveau RDV', 'Gérer Planning', 'Fiche Client', 'Stock Produits'],
        garage: ['Nouveau Devis', 'Planning Atelier', 'Suivi Réparations', 'Stock Pièces'],
        boutique: ['Nouvelle Vente', 'Gérer Stock', 'Commandes Web', 'Promotions'],
        institut: ['Nouveau Soin', 'Planning Beautés', 'Produits Conseils', 'Forfaits'],
        boulangerie: ['Production Jour', 'Commandes Spéciales', 'Stock Ingrédients'],
        pharmacie: ['Nouvelle Ordonnance', 'Stock Médicaments', 'Tiers Payant'],
        pressing: ['Nouveau Ticket', 'Suivi Vêtements', 'Tarifs Services'],
        opticien: ['Nouvelle Ordonnance', 'Catalogue Montures', 'Essayage Virtuel'],
        fleuriste: ['Nouvelle Composition', 'Livraisons Jour', 'Événements'],
        dentiste: ['Nouveau RDV', 'Dossier Patient', 'Planning Soins']
    };
    
    const businessActions = actions[selectedBusiness] || actions.restaurant;
    
    return businessActions.slice(0, 5).map(action => `
        <button class="w-full p-3 text-left rounded-xl bg-gradient-to-r from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 transition-all transform hover:scale-105 shadow-sm">
            <div class="flex items-center">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center mr-3" style="background: linear-gradient(135deg, ${businessData.primaryColor}20, ${businessData.secondaryColor}20);">
                    <i class="fas fa-plus text-sm" style="color: ${businessData.primaryColor};"></i>
                </div>
                <span class="font-medium text-gray-800">${action}</span>
            </div>
        </button>
    `).join('');
}

function generateClientServicesDisplay() {
    const allSelectedOptions = [...businessData.includedOptions, ...businessData.additionalOptions];
    const allOptions = businessOptions[selectedBusiness] || [];
    
    return allSelectedOptions.slice(0, 6).map(optId => {
        const option = allOptions.find(o => o.id === optId);
        if (!option) return '';
        
        return `
            <div class="p-6 rounded-xl bg-gradient-to-br from-gray-50 to-white border border-gray-200 hover:shadow-lg transition-all transform hover:scale-105">
                <div class="w-12 h-12 rounded-xl flex items-center justify-center mb-4" style="background: linear-gradient(135deg, ${businessData.primaryColor}, ${businessData.secondaryColor});">
                    <i class="fas fa-${getOptionIcon(option.id)} text-white"></i>
                </div>
                <h3 class="font-bold text-lg text-gray-900 mb-2">${option.name}</h3>
                <p class="text-gray-600 text-sm mb-4">${option.desc}</p>
                <button class="text-sm font-semibold hover:underline" style="color: ${businessData.primaryColor};">
                    En savoir plus →
                </button>
            </div>
        `;
    }).join('');
}

function generateReviewsDisplay() {
    const reviews = [
        { name: 'Marie L.', rating: 5, text: 'Service exceptionnel ! Je recommande vivement.' },
        { name: 'Pierre M.', rating: 5, text: 'Très satisfait de ma visite, équipe professionnelle.' },
        { name: 'Sophie B.', rating: 4, text: 'Bonne expérience, je reviendrai avec plaisir.' }
    ];
    
    return reviews.map(review => `
        <div class="p-6 rounded-xl bg-gradient-to-br from-yellow-50 to-orange-50 border border-yellow-200">
            <div class="flex items-center justify-between mb-3">
                <h4 class="font-bold text-gray-900">${review.name}</h4>
                <div class="flex text-yellow-500">
                    ${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}
                </div>
            </div>
            <p class="text-gray-700 text-sm italic">"${review.text}"</p>
        </div>
    `).join('');
}

function getOptionIcon(optionId) {
    const icons = {
        menu_digital: 'utensils',
        reservation: 'calendar-alt',
        commande_ligne: 'shopping-cart',
        caisse: 'cash-register',
        avis_clients: 'star',
        stock_ingredients: 'boxes',
        planning_equipe: 'users-cog',
        fidelite: 'gift',
        carte_vins: 'wine-glass-alt',
        livraison: 'truck',
        click_collect: 'hand-holding',
        default: 'cog'
    };
    return icons[optionId] || icons.default;
}

function regenerateTemplates() {
    // Remettre les loading
    document.getElementById('managerPreview').innerHTML = `
        <div class="generating h-64 flex items-center justify-center rounded-lg">
            <div class="text-center">
                <div class="relative">
                    <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-opacity-25 mx-auto mb-4"></div>
                    <div class="absolute inset-0 animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent mx-auto mb-4"></div>
                </div>
                <p class="text-gray-600 font-medium">Régénération template manager premium...</p>
                <p class="text-sm text-gray-500 mt-1">Interface niveau agence web</p>
            </div>
        </div>
    `;
    
    document.getElementById('clientPreview').innerHTML = `
        <div class="generating h-64 flex items-center justify-center rounded-lg">
            <div class="text-center">
                <div class="relative">
                    <div class="animate-spin rounded-full h-16 w-16 border-4 border-green-600 border-opacity-25 mx-auto mb-4"></div>
                    <div class="absolute inset-0 animate-spin rounded-full h-16 w-16 border-4 border-green-600 border-t-transparent mx-auto mb-4"></div>
                </div>
                <p class="text-gray-600 font-medium">Régénération template client premium...</p>
                <p class="text-sm text-gray-500 mt-1">Experience utilisateur optimisée</p>
            </div>
        </div>
    `;
    
    // Régénérer après délai
    setTimeout(() => {
        generateManagerTemplate();
        generateClientTemplate();
        updateFeaturesLists();
    }, 2000);
}

function validateSolution() {
    // Envoyer au CRM parent
    if (window.parent !== window) {
        window.parent.postMessage({
            type: 'BUSINESS_SOLUTION_VALIDATED',
            data: {
                business: selectedBusiness,
                plan: selectedPlan,
                businessData: businessData,
                totalPrice: `${pricingPlans[selectedPlan].price}€/mois`,
                selectedOptions: [...businessData.includedOptions, ...businessData.additionalOptions],
                includedOptionsCount: businessData.includedOptions.length,
                additionalOptionsCount: businessData.additionalOptions.length,
                timestamp: new Date().toISOString()
            }
        }, '*');
    }
    
    // Animation de succès premium
    const successDiv = document.createElement('div');
    successDiv.innerHTML = `
        <div class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm z-50 flex items-center justify-center">
            <div class="bg-white rounded-3xl p-10 text-center max-w-lg mx-4 shadow-2xl transform scale-110">
                <div class="text-8xl mb-6 animate-bounce">🎉</div>
                <h2 class="text-3xl font-bold mb-6 bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">
                    Solution Premium Validée !
                </h2>
                <p class="text-gray-600 mb-8 text-lg">Votre prospect est conquis par ces templates métier haut de gamme !</p>
                
                <div class="bg-gradient-to-r from-gray-50 to-blue-50 rounded-2xl p-6 mb-8">
                    <div class="space-y-3 text-left">
                        <div class="flex justify-between items-center">
                            <span class="font-medium">Métier:</span>
                            <span class="font-bold capitalize text-blue-600">${selectedBusiness}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-medium">Plan:</span>
                            <span class="font-bold text-purple-600">${pricingPlans[selectedPlan].name}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-medium">Options incluses:</span>
                            <span class="font-bold text-green-600">${businessData.includedOptions.length}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="font-medium">Options supplémentaires:</span>
                            <span class="font-bold text-blue-600">${businessData.additionalOptions.length}</span>
                        </div>
                        <div class="flex justify-between items-center border-t pt-3">
                            <span class="font-bold text-lg">Prix total:</span>
                            <span class="font-bold text-2xl text-green-600">${pricingPlans[selectedPlan].price}€/mois</span>
                        </div>
                    </div>
                </div>
                
                <button onclick="this.parentElement.parentElement.remove()" class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-10 py-4 rounded-2xl font-bold text-lg hover:shadow-xl transition-all transform hover:scale-105">
                    <i class="fas fa-rocket mr-2"></i>Parfait ! Finaliser la vente 🚀
                </button>
                
                <div class="mt-4 text-sm text-gray-500">
                    Templates niveau agence web • Support premium inclus
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(successDiv);
}

// Navigation entre phases
function showPhase(phaseId) {
    document.querySelectorAll('.phase').forEach(phase => phase.classList.remove('active'));
    setTimeout(() => {
        document.getElementById(phaseId).classList.add('active');
    }, 100);
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Validation temps réel des infos business
    ['businessName', 'businessCity'].forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.addEventListener('input', validateBusinessInfo);
        }
    });
    
    console.log('🎯 Agent IA Métier V3.0 initialisé avec succès !');
    console.log('📊 Plans disponibles:', Object.keys(pricingPlans));
    console.log('🏢 Métiers supportés:', Object.keys(businessOptions).length);
});

// Health check avancé
window.healthCheck = function() {
    return {
        status: 'healthy',
        version: '3.0-premium-plans',
        timestamp: new Date().toISOString(),
        selectedBusiness: selectedBusiness,
        selectedPlan: selectedPlan,
        includedOptionsCount: businessData.includedOptions.length,
        additionalOptionsCount: businessData.additionalOptions.length,
        totalPrice: selectedPlan ? `${pricingPlans[selectedPlan].price}€/mois` : '0€/mois',
        features: {
            premiumTemplates: true,
            intelligentPricing: true,
            fullPagePreviews: true,
            glassmorphismDesign: true
        }
    };
};

// Export pour tests
window.businessGenerator = {
    selectBusiness,
    selectPlan,
    generateTemplates,
    validateSolution,
    pricingPlans,
    businessOptions,
    healthCheck: window.healthCheck
};

</script>

</body>
</html>
